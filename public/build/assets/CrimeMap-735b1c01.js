import{o as m,d as p,b as t,t as u,y as B,h as g,k as _,F as C,j as k,a as D,Q as I,m as v,z as T,A as S,q as U,e as F,v as $,l as R,c as Q,w as L,u as j,Z as q}from"./app-59f66305.js";import{l as x}from"./leaflet-src-10abcd12.js";import"./leaflet.markercluster-src-b6ba4176.js";import{_ as P}from"./_plugin-vue_export-helper-c27b6911.js";import{_ as G}from"./PageTemplate-06a9faf5.js";import"./NavLink-5e46c6e3.js";import"./ResponsiveNavLink-c41a3cb4.js";const Y={name:"CrimeData",props:{crimeData:{type:Object,required:!0}},methods:{formatDate(c){const{month:r,hour:n,year:b}=c;return`${r}/${b} ${n}:00`}}},z={class:"crime-card p-4 border rounded-md shadow-md mb-4 bg-white hover:bg-gray-100 transition duration-300 ease-in-out"},W={class:"flex flex-col md:flex-row md:justify-between md:items-center"},H={class:"mb-2 md:mb-0"},K={class:"text-xl font-semibold mb-1"},Z={class:"text-gray-600"},J={class:"text-sm text-gray-500"},X={class:"mt-2 text-sm text-gray-600"};function ee(c,r,n,b,f,i){return m(),p("div",z,[t("div",W,[t("div",H,[t("h4",K,"Incident Number: "+u(n.crimeData.incident_number),1),t("p",Z,"Offense: "+u(n.crimeData.offense_description),1)]),t("div",J,[t("p",null,"District: "+u(n.crimeData.district),1),t("p",null,"Date: "+u(i.formatDate(n.crimeData)),1)])]),t("div",X,[t("p",null,"Offense Code: "+u(n.crimeData.offense_code),1),t("p",null,"Reporting Area: "+u(n.crimeData.reporting_area),1),t("p",null,"Shooting: "+u(n.crimeData.shooting?"Yes":"No"),1),t("p",null,"Street: "+u(n.crimeData.street),1),t("p",null,"Location: "+u(n.crimeData.location),1)])])}const te=P(Y,[["render",ee],["__scopeId","data-v-5745f064"]]),ae={name:"CrimeDataList",components:{CrimeData:te},props:{filteredCrimeData:{type:Array,required:!0},itemsPerPage:{type:Number,default:10}},data(){return{currentPage:1,inputPage:1}},computed:{totalPages(){return Math.ceil(this.filteredCrimeData.length/this.itemsPerPage)},paginatedCrimeData(){const c=(this.currentPage-1)*this.itemsPerPage,r=c+this.itemsPerPage;return this.filteredCrimeData.slice(c,r)}},watch:{currentPage(c){this.inputPage=c}},methods:{nextPage(){this.currentPage<this.totalPages&&this.currentPage++},prevPage(){this.currentPage>1&&this.currentPage--},goToPage(){this.inputPage>=1&&this.inputPage<=this.totalPages?this.currentPage=this.inputPage:this.inputPage=this.currentPage}}},se={class:"flex justify-between items-center mt-4"},oe=["disabled"],le=["max"],ne=["disabled"],re={class:"pl-5"},ie={key:0,class:"text-gray-500"},de={key:1,class:"text-gray-500"};function ue(c,r,n,b,f,i){const s=B("CrimeData");return m(),p("div",null,[t("div",se,[t("button",{onClick:r[0]||(r[0]=(...d)=>i.prevPage&&i.prevPage(...d)),disabled:f.currentPage===1,class:"p-2 bg-blue-500 text-white rounded-md hover:bg-blue-600"},"Previous",8,oe),t("div",null,[r[4]||(r[4]=t("span",null,"Page ",-1)),g(t("input",{"onUpdate:modelValue":r[1]||(r[1]=d=>f.inputPage=d),onChange:r[2]||(r[2]=(...d)=>i.goToPage&&i.goToPage(...d)),type:"number",min:"1",max:i.totalPages,class:"w-16 p-1 border rounded-md text-center"},null,40,le),[[_,f.inputPage,void 0,{number:!0}]]),t("span",null," of "+u(i.totalPages),1)]),t("button",{onClick:r[3]||(r[3]=(...d)=>i.nextPage&&i.nextPage(...d)),disabled:f.currentPage===i.totalPages,class:"p-2 bg-blue-500 text-white rounded-md hover:bg-blue-600"},"Next",8,ne)]),t("ul",re,[i.paginatedCrimeData.length===0?(m(),p("li",ie,"No results found")):(m(),p("li",de,"Number of results: "+u(n.filteredCrimeData.length),1)),(m(!0),p(C,null,k(i.paginatedCrimeData,(d,w)=>(m(),p("li",{key:w},[D(s,{crimeData:d},null,8,["crimeData"])]))),128))])])}const me=P(ae,[["render",ue]]);const ce={class:""},pe={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},ge={key:0,class:"p-2 border rounded-md w-full mb-4 overflow-scroll",rows:"5",readonly:""},be={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},fe={class:"flex flex-col"},ve=["value"],_e={class:"flex flex-col"},he=["value"],ye={class:"flex flex-col"},xe={class:"flex flex-col"},Ce={class:"flex flex-col"},De={class:"flex flex-col"},Pe={class:"flex flex-col"},we={class:"mt-6"},Se={__name:"CrimeMapComponent",setup(c){const{props:r}=I(),n=v(null),b=v(null),f=v(r.crimeData||[]),i=v([]),s=v({offense_codes:"",district:[],start_date:"",end_date:"",year:[],limit:1500,shooting:!1}),d=v("");axios.defaults.headers.common["X-CSRF-TOKEN"]=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),v([{value:"murder_and_manslaughter",label:"Murder and Manslaughter"},{value:"rape",label:"Rape"},{value:"robbery",label:"Robbery"},{value:"assault",label:"Assault"},{value:"burglary",label:"Burglary"},{value:"larceny",label:"Larceny"},{value:"auto_theft",label:"Auto Theft"},{value:"simple_assault",label:"Simple Assault"},{value:"arson",label:"Arson"},{value:"forgery_counterfeiting",label:"Forgery and Counterfeiting"},{value:"fraud",label:"Fraud"},{value:"embezzlement",label:"Embezzlement"},{value:"stolen_property",label:"Stolen Property"},{value:"vandalism",label:"Vandalism"},{value:"weapons_violations",label:"Weapons Violations"},{value:"prostitution",label:"Prostitution"},{value:"sex_offenses",label:"Sex Offenses"},{value:"drug_violations",label:"Drug Violations"},{value:"gambling",label:"Gambling"},{value:"child_offenses",label:"Child Offenses"},{value:"alcohol_violations",label:"Alcohol Violations"},{value:"disorderly_conduct",label:"Disorderly Conduct"},{value:"kidnapping",label:"Kidnapping"},{value:"miscellaneous_offenses",label:"Miscellaneous Offenses"},{value:"vehicle_laws",label:"Vehicle Laws"},{value:"investigations",label:"Investigations"},{value:"other_services",label:"Other Services"},{value:"property",label:"Property"},{value:"disputes",label:"Disputes"},{value:"animal_incidents",label:"Animal Incidents"},{value:"missing_persons",label:"Missing Persons"},{value:"other_reports",label:"Other Reports"},{value:"accidents",label:"Accidents"}]);const w=["A1","A15","A7","B2","B3","C11","C6","D14","D4","E13"],M=["2024","2023","2022","2021","2020","2019","2018","2017"];T(()=>{n.value=S(x.map("map").setView([42.3601,-71.0589],13)),x.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(n.value),b.value=S(x.markerClusterGroup()),n.value.addLayer(b.value),h()});const h=async()=>{try{const e=(await axios.post("/api/crime-data",{filters:s.value})).data;b.value.clearLayers(),i.value=e.crimeData,e.crimeData.forEach(a=>{if(a.lat&&a.long){const y=`
          <div>
            <strong>Incident Number:</strong> ${a.incident_number}<br>
            <strong>Offense Code:</strong> ${a.offense_code}<br>
            <strong>Offense Code Group:</strong> ${a.offense_code_group}<br>
            <strong>Offense Description:</strong> ${a.offense_description}<br>
            <strong>District:</strong> ${a.district}<br>
            <strong>Reporting Area:</strong> ${a.reporting_area}<br>
            <strong>Shooting:</strong> ${a.shooting?"Yes":"No"}<br>
            <strong>Occurred On:</strong> ${new Date(a.occurred_on_date).toLocaleString()}<br>
            <strong>Year:</strong> ${a.year}<br>
            <strong>Month:</strong> ${a.month}<br>
            <strong>Day of Week:</strong> ${a.day_of_week}<br>
            <strong>Hour:</strong> ${a.hour}<br>
            <strong>UCR Part:</strong> ${a.ucr_part}<br>
            <strong>Street:</strong> ${a.street}<br>
            <strong>Location:</strong> ${a.location}
          </div>
        `,l=S(x.marker([a.lat,a.long]));l.bindPopup(y),b.value.addLayer(l)}})}catch(o){console.error("Failed to fetch crime data",o)}},O=o=>typeof o=="string"&&(o=o.replace(/[\r\n]+/g," "),o.includes(","))?`"${o.replace(/"/g,'""')}"`:o,A=()=>{const o=[["Incident Number","Offense Code","Offense Code Group","Offense Description","District","Reporting Area","Shooting","Occurred On Date","Year","Month","Day of Week","Hour","UCR Part","Street","Lat","Long","Location"].map(O).join(","),...i.value.map(l=>[l.incident_number,l.offense_code,l.offense_code_group,l.offense_description,l.district,l.reporting_area,l.shooting?"Yes":"No",new Date(l.occurred_on_date).toLocaleString(),l.year,l.month,l.day_of_week,l.hour,l.ucr_part,l.street,l.lat,l.long,l.location].map(O).join(","))].join(`
`),e=new Blob([o],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),y=URL.createObjectURL(e);a.setAttribute("href",y),a.setAttribute("download","crime_data.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},V=o=>{const e=new Date(o),a=e.getFullYear(),y=String(e.getMonth()+1).padStart(2,"0"),l=String(e.getDate()).padStart(2,"0");return`${a}-${y}-${l}`},E=async()=>{try{document.getElementById("submitQuery").innerText="Loading...",document.getElementById("submitQuery").disabled=!0;const e=(await axios.post("/api/natural-language-query",{query:d.value})).data;f.value=e.crimeData,Object.keys(s.value).forEach(a=>{e.filters.hasOwnProperty(a)?a==="start_date"||a==="end_date"?s.value[a]=V(e.filters[a]):s.value[a]=e.filters[a]:s.value[a]=""}),document.getElementById("submitQuery").innerText="Submit to GPT-4o-mini",document.getElementById("submitQuery").disabled=!1,h()}catch(o){document.getElementById("submitQuery").innerText="Submit to GPT-4o-mini",document.getElementById("submitQuery").disabled=!1,console.error("Failed to process natural language query",o)}},N=()=>{Object.keys(s.value).forEach(o=>{o==="district"||o==="year"?s.value[o]=[]:o==="shooting"?s.value[o]=!1:s.value[o]=""}),h()};return U(s,h,{deep:!0}),(o,e)=>(m(),p(C,null,[t("div",ce,[e[20]||(e[20]=t("h3",{class:"text-2xl font-semibold mb-4"},"Interactive Boston Crime Map",-1)),e[21]||(e[21]=t("div",{id:"map",class:"h-[70vh] mb-6"},null,-1)),e[22]||(e[22]=t("h4",{class:"text-lg font-semibold mb-4"},"Natural Language Query",-1)),e[23]||(e[23]=t("p",{class:"mb-4"},"Enter a natural language query to filter the crime data:",-1)),t("div",pe,[t("button",{onClick:e[0]||(e[0]=a=>d.value="All the fraud that happened last week"),class:"p-2 border rounded-md w-full mb-4"},"All the fraud that happened last week"),t("button",{onClick:e[1]||(e[1]=a=>d.value="Last month's welfare checks"),class:"p-2 border rounded-md w-full mb-4"},"Last month's welfare checks"),t("button",{onClick:e[2]||(e[2]=a=>d.value="Todo el robo que ocurrió el mes pasado"),class:"p-2 border rounded-md w-full mb-4"},"Todo el robo que ocurrió el mes pasado")]),g(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a),type:"text",placeholder:"Example: All the fraud that happened last week",class:"p-2 border rounded-md w-full mb-4"},null,512),[[_,d.value]]),t("button",{onClick:E,id:"submitQuery",class:"p-2 bg-blue-500 text-white rounded-md mb-4"},"Submit to GPT-4o-mini"),s.value?(m(),p("pre",ge,u(JSON.stringify(s.value,null,2)),1)):F("",!0),e[24]||(e[24]=t("h4",{class:"text-lg font-semibold mb-4"},"Or Use Manual Filters",-1)),e[25]||(e[25]=t("p",{class:"mb-4"},"Use the manual filters below to filter the crime data:",-1)),t("div",be,[t("div",fe,[e[12]||(e[12]=t("label",{for:"district",class:"font-medium mb-1"},"Choose Districts:",-1)),g(t("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>s.value.district=a),multiple:"",class:"p-2 border rounded-md"},[e[11]||(e[11]=t("option",{value:""},"All",-1)),(m(),p(C,null,k(w,a=>t("option",{key:a,value:a},u(a),9,ve)),64))],512),[[$,s.value.district]])]),t("div",_e,[e[14]||(e[14]=t("label",{for:"year",class:"font-medium mb-1"},"Choose Years:",-1)),g(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.year=a),multiple:"",class:"p-2 border rounded-md"},[e[13]||(e[13]=t("option",{value:""},"All",-1)),(m(),p(C,null,k(M,a=>t("option",{key:a,value:a},u(a),9,he)),64))],512),[[$,s.value.year]])]),t("div",ye,[e[15]||(e[15]=t("label",{for:"offenseCodes",class:"font-medium mb-1"},"Enter Offense Codes (comma separated):",-1)),g(t("input",{"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.offense_codes=a),class:"p-2 border rounded-md",placeholder:"1103, 1104"},null,512),[[_,s.value.offense_codes]])]),t("div",xe,[e[16]||(e[16]=t("label",{for:"startDate",class:"font-medium mb-1"},"Start Date:",-1)),g(t("input",{type:"date","onUpdate:modelValue":e[7]||(e[7]=a=>s.value.start_date=a),class:"p-2 border rounded-md"},null,512),[[_,s.value.start_date]])]),t("div",Ce,[e[17]||(e[17]=t("label",{for:"endDate",class:"font-medium mb-1"},"End Date:",-1)),g(t("input",{type:"date","onUpdate:modelValue":e[8]||(e[8]=a=>s.value.end_date=a),class:"p-2 border rounded-md"},null,512),[[_,s.value.end_date]])]),t("div",De,[e[18]||(e[18]=t("label",{for:"shooting",class:"font-medium mb-1"},"Shooting:",-1)),g(t("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=a=>s.value.shooting=a),class:"p-2 border rounded-md"},null,512),[[R,s.value.shooting]])]),t("div",Pe,[e[19]||(e[19]=t("label",{for:"limit",class:"font-medium mb-1"},"Record Limit:",-1)),g(t("input",{type:"number","onUpdate:modelValue":e[10]||(e[10]=a=>s.value.limit=a),class:"p-2 border rounded-md"},null,512),[[_,s.value.limit]])])]),t("button",{onClick:h,class:"mt-4 p-2 bg-blue-500 text-white rounded-md"},"Submit Filters"),t("button",{onClick:N,class:"m-4 p-2 bg-blue-500 text-white rounded-md"},"Clear Filters")]),t("div",we,[e[26]||(e[26]=t("h4",{class:"text-lg font-semibold mb-4"},"List of Crime Data Points",-1)),t("button",{onClick:A,class:"p-2 bg-green-500 text-white rounded-md mb-4"},"Download as CSV"),D(me,{filteredCrimeData:i.value},null,8,["filteredCrimeData"])])],64))}},ke=P(Se,[["__scopeId","data-v-a2c6627c"]]);const Oe={__name:"CrimeMap",setup(c){return(r,n)=>(m(),Q(G,null,{default:L(()=>[D(j(q),null,{default:L(()=>n[0]||(n[0]=[t("title",null,"Crime Map",-1)])),_:1,__:[0]}),D(ke)]),_:1}))}},Be=P(Oe,[["__scopeId","data-v-37f407ee"]]);export{Be as default};
