import{l as c}from"./leaflet-src-10abcd12.js";import{_ as b}from"./_plugin-vue_export-helper-c27b6911.js";import{m,z as A,D as S,q as _,o as y,d as M,b as w,A as g,g as $,y as k,c as T,w as z,a as C,j as L,n as Z,t as D,F as q}from"./app-59f66305.js";import{_ as E}from"./PageTemplate-06a9faf5.js";import{A as P}from"./AiAssistant-9112a77e.js";import"./NavLink-5e46c6e3.js";import"./ResponsiveNavLink-c41a3cb4.js";import"./index-72ab45cd.js";const F={class:"boston-map"},I={__name:"BostonMap",props:{dataPoints:{type:Array,required:!0,default:()=>[]},center:{type:Array,required:!0},centralLocation:{type:Object,required:!0},centerSelectionActive:{type:Boolean,required:!0},cancelNewMarker:{type:Boolean,required:!0,default:!1}},emits:["map-click","marker-click"],setup(p,{emit:a}){const l=o=>{let e="default-div-icon";switch(o){case"Crime":e="crime-div-icon";break;case"311 Case":e="case-div-icon";break;case"Building Permit":e="permit-div-icon";break;case"Center":e="center-div-icon";break}return c.divIcon({className:e,html:"<div></div>",iconSize:null,popupAnchor:[0,-15]})},n=p,r=a,t=m(null),u=m(null),i=m(null);A(()=>{S(()=>{if(t.value=g(c.map("map").setView(n.center||[42.3601,-71.0589],16)),c.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(t.value),!t.value){console.error("Map initialization failed");return}console.log("Map initialized with center:",n.center),console.log("Initial zoom level:",t.value.getZoom());const o=()=>{if(!t.value){console.error("Map not defined during zoomend");return}const e=t.value.getZoom(),f=2,h=50,s=10,B=19,x=f+(h-f)*(e-s)/(B-s);console.log("Zoom level:",e),console.log("Calculated icon size:",x),document.documentElement.style.setProperty("--icon-size",`${x}px`)};t.value.on("zoomend",o),console.log("Zoomend listener attached"),o(),t.value.on("click",e=>{n.centerSelectionActive&&(r("map-click",e.latlng),i.value&&t.value.removeLayer(i.value),i.value=g(c.marker([e.latlng.lat,e.latlng.lng],{icon:l("Center")})).addTo(t.value))}),u.value=g(c.marker(n.center,{icon:l("Center")})).addTo(t.value),v(n.dataPoints)})});const d=m([]),v=o=>{t.value&&(d.value.forEach(e=>t.value.removeLayer(e)),d.value=[],o.forEach(e=>{if(e.latitude&&e.longitude){const h=`
        ${`

         <div><strong>${new Date(e.date).toLocaleString()}</strong>
      `}
        ${e.type==="Crime"?e.info.offense_description:""}
        ${e.type==="311 Case"?e.info.case_title:""}
        ${e.type==="Building Permit"?e.info.description:""}
        </div>
      `,s=g(c.marker([e.latitude,e.longitude],{icon:l(e.type)}));s.on("click",()=>{r("marker-click",e)}),s.bindPopup(h).openPopup(),s.addTo(t.value),d.value.push(s)}}))};return _(()=>n.dataPoints,v,{deep:!0}),_(()=>n.center,o=>{t.value&&t.value.setView(o)}),_(()=>n.centralLocation,o=>{u.value&&t.value.removeLayer(u.value),u.value=c.marker([o.latitude,o.longitude],{icon:l("Center")}).addTo(t.value)}),_(()=>n.cancelNewMarker,o=>{console.log("cancel",o),o&&i.value&&t.value.removeLayer(i.value)}),(o,e)=>(y(),M("div",F,e[0]||(e[0]=[w("div",{id:"map",class:"h-full mb-6 rounded-lg shadow-lg"},null,-1)])))}},N=b(I,[["__scopeId","data-v-a0dcf789"]]);const V={name:"GenericMap",components:{BostonMap:N,PageTemplate:E,AiAssistant:P},props:["dataPoints"],setup(p){const a=m({});p.dataPoints.forEach(r=>{a.value[r.type]||(a.value[r.type]=!0)});const l=$(()=>p.dataPoints.filter(r=>a.value[r.type]));return{filters:a,filteredDataPoints:l,toggleFilter:r=>{a.value[r]=!a.value[r]}}}},G={class:"filter-container"},H=["onClick"];function j(p,a,l,n,r,t){const u=k("Head"),i=k("BostonMap"),d=k("AiAssistant"),v=k("PageTemplate");return y(),T(v,null,{default:z(()=>[C(u,null,{default:z(()=>a[0]||(a[0]=[w("title",null,"Home",-1)])),_:1,__:[0]}),w("div",G,[(y(!0),M(q,null,L(n.filters,(o,e)=>(y(),M("button",{key:e,onClick:f=>n.toggleFilter(e),class:Z([{active:o,inactive:!o},"filter-button"])},D(e),11,H))),128))]),C(i,{dataPoints:n.filteredDataPoints},null,8,["dataPoints"]),C(d,{context:n.filteredDataPoints},null,8,["context"])]),_:1})}const Y=b(V,[["render",j],["__scopeId","data-v-8ff9e611"]]);export{Y as default};
