import{M as ke,m as Me}from"./index-72ab45cd.js";import{_ as Y}from"./_plugin-vue_export-helper-c27b6911.js";import{m as v,o as c,d as u,b as a,t as h,e as P,F as Z,j as ee,n as Q,s as Se,g as q,q as G,z as Ce,f as W,a as ie,D as Te}from"./app-59f66305.js";const _e={class:"relative assistant-message bg-gray-700 text-gray-100 p-3 rounded-lg shadow mr-10 inline-block max-w-[95%] float-left mb-2 text-left"},Ie={class:"text-gray-100"},$e={class:"absolute top-1 left-1 sm:top-2 sm:left-2"},Le={key:0,class:"absolute left-0 top-full mt-1 flex flex-col gap-1 bg-gray-800 p-1 rounded shadow-lg z-20 min-w-max"},Ae={key:0,class:"user-message bg-sky-600 text-white p-3 rounded-lg shadow ml-10 inline-block max-w-[95%] float-right mb-2 text-right pr-10"},Re={key:1,class:"assistant-message bg-gray-700 text-gray-100 p-3 rounded-lg shadow mr-10 inline-block max-w-[95%] float-left mb-2 text-left"},ze=["innerHTML"],Pe={key:2,class:"message-edit-area my-2 p-2 bg-gray-700 rounded"},Be=["value"],Ee={class:"edit-actions mt-2 text-right"},Ne=["onClick"],Ve=["onClick"],De=["onClick"],He=["onClick"],je=["onClick"],Oe={key:0,class:"loading-indicator text-center p-3 text-gray-300"},Ue={key:0},qe={class:"font-mono text-lg mt-1 animate-pulse"},Fe={key:1},Ke={__name:"ChatHistory",props:{messages:Array,loading:Boolean,editingMessageId:String,editedMessageContent:String,welcomeMessage:String,renderMarkdown:Function,detailedLoadingInfo:{type:Object,default:null}},emits:["update:editedMessageContent","save-edit","cancel-edit","start-edit","delete-message","copy-message"],setup(l,{expose:g,emit:$}){const L=l,s=$,b=v(null),m=v(null),p=v(!1),T=()=>{b.value&&(b.value.scrollTop=b.value.scrollHeight)},S=y=>{m.value===y?m.value=null:(m.value=y,p.value=!1)},x=()=>{p.value=!p.value,p.value&&(m.value=null)},R=y=>{s("start-edit",y),m.value=null},V=(y,w)=>{s("copy-message",y,w),m.value=null},B=y=>{s("delete-message",y),m.value=null},A=()=>{s("copy-message",L.welcomeMessage,!0),p.value=!1};return g({scrollToBottom:T}),(y,w)=>(c(),u("div",{ref_key:"chatHistoryContainerRef",ref:b,class:"p-2 bg-gray-600 chat-history max-h-[60vh] overflow-y-auto mb-4 scrollbar-thin scrollbar-thumb-gray-500 scrollbar-track-gray-700"},[a("div",{class:"absolute top-4 right-6 z-10"},[a("button",{onClick:T,class:"bg-gray-700 text-white rounded-full p-2 shadow hover:bg-gray-800 focus:outline-none"}," â¬‡ï¸ ")]),a("div",_e,[a("p",Ie,"Â Â Â Â "+h(l.welcomeMessage),1),a("div",$e,[a("button",{onClick:x,title:"Actions",class:"action-button"},"â‹®"),p.value?(c(),u("div",Le,[a("button",{onClick:A,class:"action-button-menu-item"},"ðŸ“‹ Copy")])):P("",!0)])]),(c(!0),u(Z,null,ee(l.messages,r=>(c(),u("div",{key:r.id,class:"message-item mb-2 clear-both relative"},[r.role==="user"&&l.editingMessageId!==r.id?(c(),u("p",Ae,h(r.content),1)):P("",!0),r.role==="assistant"&&l.editingMessageId!==r.id?(c(),u("div",Re,[a("div",{innerHTML:l.renderMarkdown(r.content)},null,8,ze)])):P("",!0),l.editingMessageId===r.id?(c(),u("div",Pe,[a("textarea",{value:l.editedMessageContent,onInput:w[0]||(w[0]=k=>y.$emit("update:editedMessageContent",k.target.value)),class:"w-full p-2 border border-gray-500 bg-gray-600 text-white rounded text-sm",rows:"3"},null,40,Be),a("div",Ee,[a("button",{onClick:k=>y.$emit("save-edit",r.id),class:"text-xs bg-green-500 hover:bg-green-600 text-white py-1 px-3 rounded mr-2"},"Save",8,Ne),a("button",{onClick:w[1]||(w[1]=k=>y.$emit("cancel-edit")),class:"text-xs bg-gray-500 hover:bg-gray-600 text-white py-1 px-3 rounded"},"Cancel")])])):P("",!0),l.editingMessageId!==r.id?(c(),u("div",{key:3,class:Q(["absolute",r.role==="user"?"top-1 right-1 sm:top-2 sm:right-2":"top-1 left-1 sm:top-2 sm:left-2"])},[a("button",{onClick:k=>S(r.id),title:"Actions",class:"action-button"}," â‹® ",8,Ve),m.value===r.id?(c(),u("div",{key:0,class:Q(["absolute mt-1 flex flex-col gap-1 bg-gray-800 p-1 rounded shadow-lg z-20 min-w-max",r.role==="user"?"right-0 top-full":"left-0 top-full"])},[a("button",{onClick:k=>R(r),class:"action-button-menu-item"},"âœï¸ Edit",8,De),a("button",{onClick:k=>V(r.content,r.role==="assistant"),class:"action-button-menu-item"},"ðŸ“‹ Copy",8,He),a("button",{onClick:k=>B(r.id),class:"action-button-menu-item"},"ðŸ—‘ï¸ Delete",8,je)],2)):P("",!0)],2)):P("",!0)]))),128)),l.loading?(c(),u("div",Oe,[l.detailedLoadingInfo&&l.detailedLoadingInfo.text?(c(),u("div",Ue,[a("p",qe,h(l.detailedLoadingInfo.seconds)+"s",1)])):(c(),u("div",Fe,w[2]||(w[2]=[a("p",{class:"assistant-thinking-animation text-lg"},"...",-1)])))])):P("",!0)],512))}},Je=Y(Ke,[["__scopeId","data-v-a6140873"]]);const Xe={class:"suggested-prompts flex flex-row items-baseline gap-2 mb-4 justify-end flex-wrap"},Ge={class:"text-sm text-gray-900 mr-2"},We=["onClick"],Qe=["value"],Ye={class:"flex items-center justify-between mt-3"},Ze={class:"flex gap-2"},et=["disabled"],tt={type:"submit",class:"send-button cursor-pointer bg-sky-600 hover:bg-sky-700 text-white p-3 rounded-md text-sm w-auto"},nt={__name:"ChatInput",props:{modelValueMessage:String,modelValueSelectedModel:String,canStreamReport:Boolean,languageButtonLabels:Object,currentLocale:String,suggestedPrompts:Array},emits:["update:modelValueMessage","update:modelValueSelectedModel","submit-chat","trigger-stream-report","insert-prompt"],setup(l,{emit:g}){const $=l,L=g,s=()=>{$.modelValueMessage.trim()!==""&&L("submit-chat",$.modelValueMessage,$.modelValueSelectedModel)};return(b,m)=>{var p,T,S;return c(),u("div",null,[a("div",Xe,[a("p",Ge,h(((p=l.languageButtonLabels[l.currentLocale])==null?void 0:p.suggestedPromptsText)||"Suggested Prompts:"),1),(c(!0),u(Z,null,ee(l.suggestedPrompts,x=>(c(),u("button",{key:x.id,onClick:R=>b.$emit("insert-prompt",x.text),class:"bg-sky-600 hover:bg-sky-700 text-white p-2 rounded-md cursor-pointer text-sm"},h(x.text),9,We))),128))]),a("form",{onSubmit:Se(s,["prevent"]),class:"text-base clear-both"},[a("textarea",{value:l.modelValueMessage,onInput:m[0]||(m[0]=x=>b.$emit("update:modelValueMessage",x.target.value)),placeholder:"Type your message...",class:"w-full p-3 border border-gray-600 bg-gray-700 text-white rounded-md text-base focus:ring-sky-500 focus:border-sky-500",rows:"2"},null,40,Qe),a("div",Ye,[m[2]||(m[2]=a("div",{class:"model-selector"},null,-1)),a("div",Ze,[a("button",{type:"button",onClick:m[1]||(m[1]=x=>b.$emit("trigger-stream-report")),disabled:!l.canStreamReport,class:"persistent-report-button bg-teal-600 hover:bg-teal-700 text-white p-3 rounded-md cursor-pointer text-sm disabled:opacity-50 disabled:cursor-not-allowed"},h(((T=l.languageButtonLabels[l.currentLocale])==null?void 0:T.generateReportText)||"Generate Full Report"),9,et),a("button",tt,h(((S=l.languageButtonLabels[l.currentLocale])==null?void 0:S.sendText)||"Send"),1)])])],32)])}}},at=Y(nt,[["__scopeId","data-v-3cad92b4"]]);const ot={class:"ai-assistant border border-gray-700 shadow-lg p-4 bg-gray-400 text-gray-100 relative z-2"},st={class:"context-info-bar p-2 mb-3 bg-gray-700 text-md text-gray-300 rounded flex items-center gap-x-4 gap-y-2 flex-wrap"},lt={title:"Total items in context",class:"flex items-center"},it={title:"Date range of items",class:"flex items-center"},rt={class:"context-types flex gap-x-3 gap-y-1 flex-wrap"},dt=["title"],ct={key:0,class:"detailed-loading-message text-gray-900 text-center"},ut={class:"font-mono text-lg mt-1 animate-pulse"},gt={class:"text-sm"},mt={key:1,class:"loading-message text-gray-900 text-center"},pt={class:"text-lg mt-1"},vt={class:"text-sm"},ht={__name:"AiAssistant",props:{context:{type:Array,default:()=>[]},language_codes:{type:Array,default:()=>["en-US"]},centralLocation:{type:Object,default:()=>({latitude:null,longitude:null,address:""})},radius:{type:Number,default:.25},currentMapLanguage:{type:String,default:"en"}},setup(l){const g=l,$=ke({html:!0,linkify:!0,typographer:!0,breaks:!0});$.use(Me,{attrs:{target:"_blank",rel:"noopener"}});const L=v(""),s=v([]),b=v(!1),m=v(null),p=v(g.context),T=v(null),S=v(""),x=v("gemini"),R=v(!1),V=v(""),B=v(0),A=v(null),y=[{id:"ask_about_context",textKey:"askAboutContext"}],w={"en-US":{askAboutContext:"What can you tell me about these events?"},"es-MX":{askAboutContext:"Â¿QuÃ© me puedes decir sobre estos eventos?"},"zh-CN":{askAboutContext:"å…³äºŽè¿™äº›äº‹ä»¶ä½ èƒ½å‘Šè¯‰æˆ‘ä»€ä¹ˆï¼Ÿ"},"ht-HT":{askAboutContext:"Kisa ou ka di mwen sou evÃ¨nman sa yo?"},"vi-VN":{askAboutContext:"Báº¡n cÃ³ thá»ƒ cho tÃ´i biáº¿t gÃ¬ vá» nhá»¯ng sá»± kiá»‡n nÃ y?"},"pt-BR":{askAboutContext:"O que vocÃª pode me dizer sobre esses eventos?"}},r=v([]),k={"en-US":{sendText:"Send",model:"Select AI Model",generateReportText:"Generate Full Report"},"es-MX":{sendText:"Enviar",model:"Seleccionar modelo de IA",generateReportText:"Generar Informe Completo"},"zh-CN":{sendText:"å‘é€",model:"é€‰æ‹©AIæ¨¡åž‹",generateReportText:"ç”Ÿæˆå®Œæ•´æŠ¥å‘Š"},"ht-HT":{sendText:"Voye",model:"Chwazi modÃ¨l AI",generateReportText:"Jenere RapÃ² KonplÃ¨"},"vi-VN":{sendText:"Gá»­i",model:"Chá»n mÃ´ hÃ¬nh AI",generateReportText:"Táº¡o BÃ¡o cÃ¡o Äáº§y Ä‘á»§"},"pt-BR":{sendText:"Enviar",model:"Selecione o modelo de IA",generateReportText:"Gerar RelatÃ³rio Completo"}},te=v(""),ne={"en-US":"Hi! I'm the BostonScope AI Assistant. I can see all the data points in the map and answer questions about them. How can I help you today?","es-MX":"Â¡Hola! Soy el asistente de IA de la aplicaciÃ³n de Boston. Puedo ver todos los puntos de datos en el mapa y responder preguntas sobre ellos. Â¿CÃ³mo puedo ayudarte hoy?","zh-CN":"ä½ å¥½ï¼æˆ‘æ˜¯æ³¢å£«é¡¿åº”ç”¨ç¨‹åºçš„AIåŠ©æ‰‹ã€‚æˆ‘å¯ä»¥æŸ¥çœ‹åœ°å›¾ä¸­çš„æ‰€æœ‰æ•°æ®ç‚¹å¹¶ç”¨å¤šç§è¯­è¨€å›žç­”æœ‰å…³å®ƒä»¬çš„é—®é¢˜ã€‚æˆ‘ä»Šå¤©èƒ½å¸®ä½ ä»€ä¹ˆï¼Ÿ","ht-HT":"Bonjou! Mwen se asistan AI nan aplikasyon Boston an. Mwen ka wÃ¨ tout pwen done nan kat la ak reponn kesyon sou yo. Kijan mwen ka ede ou jodi a?","vi-VN":"ChÃ o báº¡n! TÃ´i lÃ  trá»£ lÃ½ trÃ­ tuá»‡ nhÃ¢n táº¡o cá»§a á»©ng dá»¥ng Boston. TÃ´i cÃ³ thá»ƒ xem táº¥t cáº£ cÃ¡c Ä‘iá»ƒm dá»¯ liá»‡u trÃªn báº£n Ä‘á»“ vÃ  tráº£ lá»i cÃ¢u há»i vá» chÃºng. HÃ´m nay tÃ´i cÃ³ thá»ƒ giÃºp gÃ¬ cho báº¡n?","pt-BR":"Oi! Eu sou o assistente de IA do aplicativo Boston. Eu posso ver todos os pontos de dados no mapa e responder perguntas sobre eles. Como posso te ajudar hoje?"},F={"en-US":{analyzing:"I'm analyzing",dataPoint:"data point",dataPoints:"data points",inTheMap:"in the map",fewSeconds:"and should have an answer in a few seconds.",tenSeconds:"this might take ten seconds or more.",thirtySeconds:"please be patient, this could take up to 30 seconds or a bit longer.",noData:"I'm ready to help! There are currently no specific data points in the map view for me to analyze with this query, but feel free to ask general questions or add data to the map."},"es-MX":{analyzing:"Estoy analizando",dataPoint:"punto de dato",dataPoints:"puntos de datos",inTheMap:"en el mapa",fewSeconds:"y deberÃ­a tener una respuesta en unos segundos.",tenSeconds:"esto podrÃ­a tardar diez segundos o mÃ¡s.",thirtySeconds:"por favor ten paciencia, esto podrÃ­a tardar hasta 30 segundos o un poco mÃ¡s.",noData:"Â¡Estoy listo para ayudar! Actualmente no hay puntos de datos especÃ­ficos en la vista del mapa para analizar con esta consulta, pero no dudes en hacer preguntas generales o agregar datos al mapa."},"zh-CN":{analyzing:"æˆ‘æ­£åœ¨åˆ†æž",dataPoint:"ä¸ªæ•°æ®ç‚¹",dataPoints:"ä¸ªæ•°æ®ç‚¹",inTheMap:"åœ¨åœ°å›¾ä¸Š",fewSeconds:"å¹¶åº”åœ¨å‡ ç§’é’Ÿå†…ç»™å‡ºç­”æ¡ˆã€‚",tenSeconds:"è¿™å¯èƒ½éœ€è¦åç§’æˆ–æ›´é•¿æ—¶é—´ã€‚",thirtySeconds:"è¯·è€å¿ƒç­‰å¾…ï¼Œè¿™å¯èƒ½éœ€è¦é•¿è¾¾30ç§’æˆ–æ›´é•¿æ—¶é—´ã€‚",noData:"æˆ‘å‡†å¤‡å¥½å¸®åŠ©æ‚¨äº†ï¼å½“å‰åœ°å›¾è§†å›¾ä¸­æ²¡æœ‰å¯ä¾›æˆ‘é€šè¿‡æ­¤æŸ¥è¯¢åˆ†æžçš„ç‰¹å®šæ•°æ®ç‚¹ï¼Œä½†æ¬¢è¿Žæ‚¨æå‡ºä¸€èˆ¬æ€§é—®é¢˜æˆ–å‘åœ°å›¾æ·»åŠ æ•°æ®ã€‚"},"ht-HT":{analyzing:"M ap analize",dataPoint:"pwen done",dataPoints:"pwen done",inTheMap:"nan kat la",fewSeconds:"epi mwen ta dwe gen yon repons nan kÃ¨k segond.",tenSeconds:"sa ka pran dis segond oswa plis.",thirtySeconds:"tanpri pran pasyans, sa ka pran jiska 30 segond oswa yon ti kras plis.",noData:"Mwen pare pou ede! Kounye a pa gen pwen done espesifik nan vi kat la pou m analize avÃ¨k demann sa a, men ou lib pou poze kesyon jeneral oswa ajoute done sou kat la."},"vi-VN":{analyzing:"TÃ´i Ä‘ang phÃ¢n tÃ­ch",dataPoint:"Ä‘iá»ƒm dá»¯ liá»‡u",dataPoints:"Ä‘iá»ƒm dá»¯ liá»‡u",inTheMap:"trÃªn báº£n Ä‘á»“",fewSeconds:"vÃ  sáº½ cÃ³ cÃ¢u tráº£ lá»i trong vÃ i giÃ¢y.",tenSeconds:"viá»‡c nÃ y cÃ³ thá»ƒ máº¥t mÆ°á»i giÃ¢y hoáº·c hÆ¡n.",thirtySeconds:"vui lÃ²ng kiÃªn nháº«n, viá»‡c nÃ y cÃ³ thá»ƒ máº¥t Ä‘áº¿n 30 giÃ¢y hoáº·c lÃ¢u hÆ¡n má»™t chÃºt.",noData:"TÃ´i sáºµn sÃ ng giÃºp Ä‘á»¡! Hiá»‡n táº¡i khÃ´ng cÃ³ Ä‘iá»ƒm dá»¯ liá»‡u cá»¥ thá»ƒ nÃ o trong cháº¿ Ä‘á»™ xem báº£n Ä‘á»“ Ä‘á»ƒ tÃ´i phÃ¢n tÃ­ch vá»›i truy váº¥n nÃ y, nhÆ°ng báº¡n cá»© tá»± nhiÃªn Ä‘áº·t cÃ¢u há»i chung hoáº·c thÃªm dá»¯ liá»‡u vÃ o báº£n Ä‘á»“."},"pt-BR":{analyzing:"Estou analisando",dataPoint:"ponto de dado",dataPoints:"pontos de dados",inTheMap:"no mapa",fewSeconds:"e devo ter uma resposta em alguns segundos.",tenSeconds:"isso pode levar dez segundos ou mais.",thirtySeconds:"por favor, seja paciente, isso pode levar atÃ© 30 segundos ou um pouco mais.",noData:"Estou pronto para ajudar! Atualmente nÃ£o hÃ¡ pontos de dados especÃ­ficos na visualizaÃ§Ã£o do mapa para eu analisar com esta consulta, mas sinta-se Ã  vontade para fazer perguntas gerais ou adicionar dados ao mapa."}},j=q(()=>g.language_codes[0]||"en-US"),re=q(()=>R.value?{text:V.value,seconds:B.value}:null),E=q(()=>{if(!p.value||p.value.length===0)return{total:0,types:{},dateRange:"N/A"};const t=p.value.reduce((e,d)=>{const i=d.alcivartech_type||"Unknown";return e[i]=(e[i]||0)+1,e},{}),o=p.value.map(e=>e.alcivartech_date?new Date(e.alcivartech_date):null).filter(e=>e&&!isNaN(e.getTime()));let n="N/A";if(o.length>0){const e=new Date(Math.min.apply(null,o)),d=new Date(Math.max.apply(null,o));!isNaN(e.getTime())&&!isNaN(d.getTime())?n=`${e.toLocaleDateString()} - ${d.toLocaleDateString()}`:n="Invalid date range"}return{total:p.value.length,types:t,dateRange:n}}),K=q(()=>g.centralLocation&&g.centralLocation.latitude!==null&&g.centralLocation.longitude!==null&&g.centralLocation.address&&g.centralLocation.address.trim()!==""),J=()=>{const t=j.value;te.value=ne[t]||ne["en-US"];let o=[...y];r.value=o.map(n=>{var e,d;return{id:n.id,text:((e=w[t])==null?void 0:e[n.textKey])||((d=w["en-US"])==null?void 0:d[n.textKey])||n.textKey}})},N=()=>{Te(()=>{m.value&&m.value.scrollToBottom()})},de=t=>{const o=j.value,n=F[o]||F["en-US"],e=F["en-US"];if(t===0)return n.noData||e.noData;let d;const i=n.analyzing||e.analyzing,_=n.dataPoint||e.dataPoint,M=n.dataPoints||e.dataPoints,C=n.inTheMap||e.inTheMap;o==="zh-CN"?d=`${i} ${t}${M}`:d=`${i} ${t} ${t===1?_:M}`,d+=` ${C}`;let I="";return t>0&&t<300?I=n.fewSeconds||e.fewSeconds:t>=300&&t<=700?I=n.tenSeconds||e.tenSeconds:t>700&&(I=n.thirtySeconds||e.thirtySeconds),`${d}, ${I}`},ce=()=>{A.value&&clearInterval(A.value),B.value=0,A.value=setInterval(()=>{B.value++},1e3)},ue=()=>{A.value&&(clearInterval(A.value),A.value=null)},ae=t=>{V.value=de(t),R.value=!0,b.value=!0,ce(),N()},oe=()=>{ue(),R.value=!1,b.value=!1},ge=t=>{L.value=t,se(t,x.value)},se=(t,o)=>{if(t.trim()==="")return;const n=t;L.value="",me(n,o,p.value)},z=()=>`msg_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,me=async(t,o,n)=>{s.value.push({id:z(),role:"user",content:t});const e=n.length;ae(e);const d={message:t,history:s.value.slice(0,-1),context:JSON.stringify(n),model:o};try{const i=await fetch(route("ai.assistant"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(d)});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);if(!i.body)throw new Error("Response body is null");const _=i.body.getReader(),M=new TextDecoder;let C="";const I=z();for(s.value.push({id:I,role:"assistant",content:""});;){const{done:X,value:D}=await _.read();if(X)break;C+=M.decode(D,{stream:!0});const H=s.value.findIndex(O=>O.id===I);H!==-1&&(s.value[H].content=C),N()}}catch(i){console.error("Error fetching AI chat response:",i);const _=z(),M=s.value[s.value.length-1];M&&M.role==="assistant"&&M.content===""?M.content=`Error: Could not get response. ${i.message}`:s.value.push({id:_,role:"assistant",content:`Error: Could not get response. ${i.message}`})}finally{oe(),N()}},pe=()=>{var n;if(!K.value)return;const t=j.value,o=((n=k[t])==null?void 0:n.generateReportText)||k["en-US"].generateReportText;ve(o)},ve=async t=>{if(!K.value){s.value.push({id:z(),role:"assistant",content:"Cannot generate report: Central location details are missing or invalid."}),N();return}s.value.push({id:z(),role:"user",content:t});const o=p.value.length;ae(o);const n=z();s.value.push({id:n,role:"assistant",content:""});let e="";try{const d={latitude:g.centralLocation.latitude,longitude:g.centralLocation.longitude,address:g.centralLocation.address,radius:g.radius,language:g.currentMapLanguage},i=await fetch(route("ai.stream-location-report"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),Accept:"text/event-stream"},body:JSON.stringify(d)});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);if(!i.body)throw new Error("Response body is null");const _=i.body.getReader(),M=new TextDecoder;let C="";for(;;){const{done:I,value:X}=await _.read();if(I)break;C+=M.decode(X,{stream:!0});let D;for(;(D=C.indexOf(`

`))>=0;){const H=C.slice(0,D);if(C=C.slice(D+2),H.startsWith("data: ")){const O=H.substring(6);try{const f=JSON.parse(O),U=s.value.findIndex(we=>we.id===n);if(U===-1)continue;if(f.type==="markdown"&&f.content)e+=f.content,s.value[U].content=e;else if(f.type==="status"&&f.message)e+=`
*Status: ${f.message}*
`,s.value[U].content=e;else if(f.type==="error"&&f.message)e+=`
**Error: ${f.message}**
`,s.value[U].content=e;else if(f.type==="control"&&f.action==="close")return;N()}catch(f){console.error("Error parsing streamed JSON:",f,O)}}}}}catch(d){console.error("Error fetching streaming report:",d);const i=s.value.findIndex(_=>_.id===n);i!==-1?s.value[i].content=e+`
**Error generating report: ${d.message}**`:s.value.push({id:z(),role:"assistant",content:e+`
**Error generating report: ${d.message}**`})}finally{oe(),N()}},he=t=>$.render(t),ye=t=>{window.confirm("Are you sure you want to delete this message?")&&(s.value=s.value.filter(o=>o.id!==t))},fe=async t=>{try{await navigator.clipboard.writeText(t),alert("Content copied to clipboard!")}catch(o){console.error("Failed to copy: ",o),alert("Failed to copy content.")}},be=t=>{T.value=t.id,S.value=t.content},xe=t=>{const o=s.value.findIndex(n=>n.id===t);o!==-1&&(s.value[o].content=S.value),le()},le=()=>{T.value=null,S.value=""};return G(()=>g.context,t=>{p.value=t}),G(()=>g.language_codes,()=>{J()},{immediate:!0}),G(()=>g.centralLocation,(t,o)=>{JSON.stringify(t)!==JSON.stringify(o)&&J()},{deep:!0,immediate:!0}),Ce(()=>{J()}),(t,o)=>(c(),u("div",ot,[a("div",st,[a("span",lt,[o[3]||(o[3]=a("svg",{class:"inline h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),W(" "+h(E.value.total)+" items ",1)]),a("span",it,[o[4]||(o[4]=a("svg",{class:"inline h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[a("path",{"fill-rule":"evenodd",d:"M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z","clip-rule":"evenodd"})],-1)),W(" "+h(E.value.dateRange),1)]),a("div",rt,[(c(!0),u(Z,null,ee(E.value.types,(n,e)=>(c(),u("span",{key:e,title:`${n} ${e} items`,class:"flex items-center p-1 text-md"},[a("span",{class:Q(["context-data-icon",{"context-icon-crime":e==="Crime","context-icon-311-case":e==="311 Case","context-icon-building-permit":e==="Building Permit","context-icon-property-violation":e==="Property Violation","context-icon-construction-off-hour":e==="Construction Off Hour","context-icon-food-inspection":e==="Food Inspection","context-icon-unknown":!["Crime","311 Case","Building Permit","Property Violation","Construction Off Hour","Food Establishment Violation"].includes(e)}])},null,2),W(" "+h(e)+": "+h(n),1)],8,dt))),128))])]),ie(Je,{ref_key:"chatHistoryComponentRef",ref:m,messages:s.value,loading:b.value,detailedLoadingInfo:re.value,editingMessageId:T.value,editedMessageContent:S.value,welcomeMessage:te.value,renderMarkdown:he,"onUpdate:editedMessageContent":o[0]||(o[0]=n=>S.value=n),onSaveEdit:xe,onCancelEdit:le,onStartEdit:be,onDeleteMessage:ye,onCopyMessage:fe},null,8,["messages","loading","detailedLoadingInfo","editingMessageId","editedMessageContent","welcomeMessage"]),R.value?(c(),u("div",ct,[a("p",ut,h(V.value),1),a("p",gt,"Elapsed: "+h(B.value)+" seconds",1)])):(c(),u("div",mt,[a("p",pt,h(E.value.total)+" data points in the map will be analyzed to respond to your query.",1),a("p",vt,"This would take "+h(E.value.total<300?"a few seconds":E.value.total<700?"ten seconds or more":"thirty seconds or longer")+".",1)])),ie(at,{modelValueMessage:L.value,"onUpdate:modelValueMessage":o[1]||(o[1]=n=>L.value=n),modelValueSelectedModel:x.value,"onUpdate:modelValueSelectedModel":o[2]||(o[2]=n=>x.value=n),canStreamReport:K.value,languageButtonLabels:k,currentLocale:j.value,suggestedPrompts:r.value,onSubmitChat:se,onTriggerStreamReport:pe,onInsertPrompt:ge},null,8,["modelValueMessage","modelValueSelectedModel","canStreamReport","currentLocale","suggestedPrompts"])]))}},xt=Y(ht,[["__scopeId","data-v-a3fb37bd"]]);export{xt as A};
