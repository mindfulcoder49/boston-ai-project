import{m as B,g as j,z as we,I as Pe,q as oe,o as p,d as f,b as t,F as X,j as Y,P as Fe,e as P,t as r,n as ie,x as le,h as se,k as Se,Q as Ae,f as Z,v as ke,a as V,w as ge,u as te,i as be,H as qe,A as fe,K as He,D as je,l as We,J as Ke,B as Qe,c as Ze,p as Xe,Z as Ye}from"./app-59f66305.js";import{_ as Je}from"./PageTemplate-06a9faf5.js";import{A as et}from"./AiAssistant-9112a77e.js";import{g as tt,U as ot,G as at}from"./SubscriptionBanner.vue_vue_type_style_index_0_scoped_7aa2f15c_lang-67917262.js";import{_ as he}from"./_plugin-vue_export-helper-c27b6911.js";import{l as ee}from"./leaflet-src-10abcd12.js";import"./leaflet.markercluster-src-b6ba4176.js";import"./NavLink-5e46c6e3.js";import"./ResponsiveNavLink-c41a3cb4.js";import"./index-72ab45cd.js";import"./Modal-65f11932.js";const nt=["onClick"],st={class:"carousel-slide-inner"},lt=["src"],it={key:1,class:"data-type-label"},rt={key:0,class:"carousel-decoration"},ct={class:"carousel-controls"},ut=["disabled"],dt=["disabled"],gt={class:"carousel-indicators"},vt=["onClick"],mt={__name:"ImageCarousel",props:{dataPoints:{type:Array,default:()=>[]},carouselHeight:{type:String,default:"300px"},modelToDataKeyMap:{type:Object,default:()=>({})},responsiveBreakpoints:{type:Object,default:()=>({1200:5,992:4,768:3,0:2})}},emits:["on-image-click"],setup(e,{emit:m}){const h=e,g=m,c=B(null),a=B(0),n=B(h.responsiveBreakpoints[0]||1),i=w=>{if(!w||!w.alcivartech_model||!h.modelToDataKeyMap)return null;const o=h.modelToDataKeyMap[w.alcivartech_model];return o?w[o]:null},v=w=>{const o=i(w);if(!o)return null;let s=null;if(w.alcivartech_model==="cambridge_311_service_requests")s=o.image_url;else if(w.alcivartech_model==="three_one_one_cases"&&(o.closed_photo?s=o.closed_photo:o.submitted_photo&&(s=o.submitted_photo),s&&typeof s=="string"&&s.includes(" | ")))return s.split(" | ")[0];return s},x=w=>{g("on-image-click",w)},b=j(()=>h.dataPoints.filter(w=>!!v(w))),L=j(()=>b.value.length>0),_=j(()=>!b.value.length||n.value===0?0:Math.ceil(b.value.length/n.value)),I=j(()=>_.value===0?!0:a.value>=_.value-1),C=()=>{a.value>0&&a.value--},A=()=>{I.value||a.value++},z=w=>{w>=0&&w<_.value&&(a.value=w)},F=()=>{if(c.value&&c.value.offsetWidth){const w=c.value.offsetWidth*a.value;c.value.scrollTo({left:w,behavior:"smooth"})}},$=()=>{const w=window.innerWidth;let o=h.responsiveBreakpoints[0]||1;const s=Object.entries(h.responsiveBreakpoints).map(([u,M])=>[parseInt(u),M]).sort((u,M)=>M[0]-u[0]);for(const[u,M]of s)if(w>=u){o=M;break}if(o===(h.responsiveBreakpoints[0]||1)&&s.length>0){const u=s[s.length-1];w<u[0]&&(o=u[1])}if(n.value!==o){n.value=o;const u=a.value*n.value;a.value=Math.floor(u/o)||0,_.value>0?a.value=Math.min(a.value,_.value-1):a.value=0}};return we(()=>{$(),window.addEventListener("resize",$),setTimeout(F,0)}),Pe(()=>{window.removeEventListener("resize",$)}),oe(a,()=>{F()}),oe([b,n],()=>{_.value>0&&a.value>=_.value?a.value=Math.max(0,_.value-1):_.value===0&&(a.value=0)},{deep:!0}),j(()=>{const w=a.value*n.value,o=w+n.value;return b.value.map((s,u)=>u).slice(w,o)}),(w,o)=>L.value?(p(),f("div",{key:0,class:"carousel-container",style:Fe({height:e.carouselHeight})},[t("div",{class:"carousel-wrapper",ref_key:"carouselWrapper",ref:c},[(p(!0),f(X,null,Y(b.value,(s,u)=>(p(),f("div",{key:s.data_point_id||u,class:"carousel-slide",style:Fe({flexBasis:`calc(100% / ${n.value})`}),onClick:M=>x(s)},[t("div",st,[v(s)?(p(),f("img",{key:0,src:v(s),alt:"Data Point Image",class:"carousel-image"},null,8,lt)):P("",!0),s.alcivartech_type?(p(),f("div",it,r(s.alcivartech_type),1)):P("",!0)])],12,nt))),128))],512),_.value>1?(p(),f("div",rt,[t("div",ct,[t("button",{onClick:C,disabled:a.value===0,class:"control-button prev-button"}," < ",8,ut),t("button",{onClick:A,disabled:I.value,class:"control-button next-button"}," > ",8,dt)]),t("div",gt,[(p(!0),f(X,null,Y(_.value,s=>(p(),f("button",{key:`indicator-${s-1}`,onClick:u=>z(s-1),class:ie({"indicator-button":!0,active:s-1===a.value})},null,10,vt))),128))])])):P("",!0)],4)):(p(),f("div",{key:1,class:"no-image-container",style:Fe({height:e.carouselHeight})}," No Images Available ",4))}},pt=he(mt,[["__scopeId","data-v-3ac6c34f"]]);var ft=typeof global=="object"&&global&&global.Object===Object&&global;const ht=ft;var yt=typeof self=="object"&&self&&self.Object===Object&&self,bt=ht||yt||Function("return this")();const Re=bt;var _t=Re.Symbol;const $e=_t;var Ue=Object.prototype,xt=Ue.hasOwnProperty,Ct=Ue.toString,Le=$e?$e.toStringTag:void 0;function Lt(e){var m=xt.call(e,Le),h=e[Le];try{e[Le]=void 0;var g=!0}catch{}var c=Ct.call(e);return g&&(m?e[Le]=h:delete e[Le]),c}var wt=Object.prototype,kt=wt.toString;function St(e){return kt.call(e)}var $t="[object Null]",Mt="[object Undefined]",ze=$e?$e.toStringTag:void 0;function Tt(e){return e==null?e===void 0?Mt:$t:ze&&ze in Object(e)?Lt(e):St(e)}function Dt(e){return e!=null&&typeof e=="object"}var Bt="[object Symbol]";function Ft(e){return typeof e=="symbol"||Dt(e)&&Tt(e)==Bt}var Gt=/\s/;function It(e){for(var m=e.length;m--&&Gt.test(e.charAt(m)););return m}var At=/^\s+/;function zt(e){return e&&e.slice(0,It(e)+1).replace(At,"")}function Ie(e){var m=typeof e;return e!=null&&(m=="object"||m=="function")}var Ee=0/0,Et=/^[-+]0x[0-9a-f]+$/i,Nt=/^0b[01]+$/i,Ot=/^0o[0-7]+$/i,jt=parseInt;function Ne(e){if(typeof e=="number")return e;if(Ft(e))return Ee;if(Ie(e)){var m=typeof e.valueOf=="function"?e.valueOf():e;e=Ie(m)?m+"":m}if(typeof e!="string")return e===0?e:+e;e=zt(e);var h=Nt.test(e);return h||Ot.test(e)?jt(e.slice(2),h?2:8):Et.test(e)?Ee:+e}var Rt=function(){return Re.Date.now()};const Ge=Rt;var Ut="Expected a function",Vt=Math.max,Pt=Math.min;function qt(e,m,h){var g,c,a,n,i,v,x=0,b=!1,L=!1,_=!0;if(typeof e!="function")throw new TypeError(Ut);m=Ne(m)||0,Ie(h)&&(b=!!h.leading,L="maxWait"in h,a=L?Vt(Ne(h.maxWait)||0,m):a,_="trailing"in h?!!h.trailing:_);function I(u){var M=g,k=c;return g=c=void 0,x=u,n=e.apply(k,M),n}function C(u){return x=u,i=setTimeout(F,m),b?I(u):n}function A(u){var M=u-v,k=u-x,l=m-M;return L?Pt(l,a-k):l}function z(u){var M=u-v,k=u-x;return v===void 0||M>=m||M<0||L&&k>=a}function F(){var u=Ge();if(z(u))return $(u);i=setTimeout(F,A(u))}function $(u){return i=void 0,_&&g?I(u):(g=c=void 0,n)}function w(){i!==void 0&&clearTimeout(i),x=0,g=v=c=i=void 0}function o(){return i===void 0?n:$(Ge())}function s(){var u=Ge(),M=z(u);if(g=arguments,c=this,v=u,M){if(i===void 0)return C(v);if(L)return clearTimeout(i),i=setTimeout(F,m),I(v)}return i===void 0&&(i=setTimeout(F,m)),n}return s.cancel=w,s.flush=o,s}const Oe={"en-US":{addressPlaceholder:"Enter address (Google Search)...",googleSuggestionsTitle:"Google Suggestions:",clearGoogleResults:"Clear Google Results",noGoogleResultsFound:"No results found via Google.",loadingGoogleResults:"Searching with Google..."},"es-MX":{addressPlaceholder:"Ingrese la dirección (Búsqueda en Google)...",googleSuggestionsTitle:"Sugerencias de Google:",clearGoogleResults:"Borrar Resultados de Google",noGoogleResultsFound:"No se encontraron resultados a través de Google.",loadingGoogleResults:"Buscando con Google..."},"zh-CN":{addressPlaceholder:"输入地址 (谷歌搜索)...",googleSuggestionsTitle:"谷歌建议:",clearGoogleResults:"清除谷歌结果",noGoogleResultsFound:"通过谷歌未找到结果。",loadingGoogleResults:"正在使用谷歌搜索..."},"ht-HT":{addressPlaceholder:"Antre adrès (Rechèch Google)...",googleSuggestionsTitle:"Sijesyon Google:",clearGoogleResults:"Efase Rezilta Google yo",noGoogleResultsFound:"Pa gen rezilta jwenn via Google.",loadingGoogleResults:"Chèche ak Google..."},"vi-VN":{addressPlaceholder:"Nhập địa chỉ (Tìm kiếm Google)...",googleSuggestionsTitle:"Gợi ý của Google:",clearGoogleResults:"Xóa kết quả của Google",noGoogleResultsFound:"Không tìm thấy kết quả nào qua Google.",loadingGoogleResults:"Đang tìm kiếm với Google..."},"pt-BR":{addressPlaceholder:"Digite o endereço (Pesquisa Google)...",googleSuggestionsTitle:"Sugestões do Google:",clearGoogleResults:"Limpar Resultados do Google",noGoogleResultsFound:"Nenhum resultado encontrado via Google.",loadingGoogleResults:"Pesquisando com o Google..."}},Ht={props:["initialSearchQuery","language_codes"],data(){return{searchQuery:this.initialSearchQuery||"",googleSuggestions:[],showGoogleSuggestions:!1,isLoadingGoogle:!1,googleSearchAttempted:!1,debouncedGoogleSearch:null}},computed:{localizedLabels(){const e=this.language_codes&&this.language_codes.length>0?this.language_codes[0]:"en-US";return Oe[e]||Oe["en-US"]}},created(){this.debouncedGoogleSearch=qt(this.fetchGoogleSuggestions,600)},methods:{handleInput(){this.searchQuery.length>=3?(this.isLoadingGoogle=!0,this.googleSearchAttempted=!0,this.debouncedGoogleSearch()):(this.clearGoogleSuggestions(),this.isLoadingGoogle=!1)},async fetchGoogleSuggestions(){if(this.searchQuery.length<3){this.isLoadingGoogle=!1;return}try{const e=await le.post("/api/google-places-autocomplete",{input:this.searchQuery});this.googleSuggestions=e.data.suggestions||[],this.showGoogleSuggestions=!0}catch(e){console.error("Error fetching Google suggestions:",e),this.googleSuggestions=[]}finally{this.isLoadingGoogle=!1}},selectAddress(e){this.$emit("address-selected",e),this.searchQuery=e.address,this.clearGoogleSuggestions()},clearGoogleSuggestions(){this.googleSuggestions=[],this.showGoogleSuggestions=!1,this.googleSearchAttempted=!1},clearGoogleSuggestionsAndQuery(){this.searchQuery="",this.clearGoogleSuggestions()},async selectGoogleSuggestion(e){this.isLoadingGoogle=!0;try{const m=await le.post("/api/geocode-google-place",{address:e}),{lat:h,lng:g,address:c}=m.data;this.selectAddress({lat:h,lng:g,address:c})}catch(m){console.error("Error geocoding Google suggestion:",m)}finally{this.isLoadingGoogle=!1,(!this.searchQuery||this.searchQuery!==e)&&this.clearGoogleSuggestions()}}},watch:{searchQuery(e){e===""&&(this.clearGoogleSuggestions(),this.isLoadingGoogle=!1)}}},Wt=["placeholder"],Kt={key:0,class:"text-gray-500 mt-2"},Qt={key:1,class:"border p-2 bg-white shadow address-result-list mt-1"},Zt={class:"p-2 text-gray-700 font-semibold"},Xt=["onClick"],Yt={key:2,class:"text-gray-500 mt-2"};function Jt(e,m,h,g,c,a){return p(),f("div",null,[se(t("input",{type:"text","onUpdate:modelValue":m[0]||(m[0]=n=>c.searchQuery=n),onInput:m[1]||(m[1]=(...n)=>a.handleInput&&a.handleInput(...n)),placeholder:a.localizedLabels.addressPlaceholder,class:"border w-full",onFocus:m[2]||(m[2]=n=>c.showGoogleSuggestions=c.googleSuggestions.length>0)},null,40,Wt),[[Se,c.searchQuery]]),c.isLoadingGoogle?(p(),f("p",Kt,r(a.localizedLabels.loadingGoogleResults),1)):P("",!0),c.googleSuggestions.length&&c.showGoogleSuggestions?(p(),f("ul",Qt,[t("li",Zt,r(a.localizedLabels.googleSuggestionsTitle),1),t("li",{class:"cursor-pointer p-2 rounded",onClick:m[3]||(m[3]=(...n)=>a.clearGoogleSuggestionsAndQuery&&a.clearGoogleSuggestionsAndQuery(...n))},r(a.localizedLabels.clearGoogleResults),1),(p(!0),f(X,null,Y(c.googleSuggestions,(n,i)=>(p(),f("li",{key:`google-${i}`,onClick:v=>a.selectGoogleSuggestion(n),class:"cursor-pointer p-2 rounded"},r(n),9,Xt))),128))])):P("",!0),c.googleSearchAttempted&&!c.googleSuggestions.length&&c.showGoogleSuggestions&&!c.isLoadingGoogle?(p(),f("p",Yt,r(a.localizedLabels.noGoogleResultsFound),1)):P("",!0)])}const eo=he(Ht,[["render",Jt],["__scopeId","data-v-e4d7316c"]]);const to={class:"p-4 border rounded-lg shadow hover:shadow-lg transition-shadow bg-white"},oo={class:"ml-2"},ao={class:"flex border-b border-gray-200"},no=["onClick"],so={class:"mt-6"},lo={key:0,class:"current-location"},io={class:"text-lg font-semibold text-gray-800 mb-4"},ro={class:"text-sm text-gray-700 mb-4 space-y-1"},co={key:0},uo={class:"space-y-4"},go={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},vo={for:"current-location-report",class:"block text-sm font-medium text-gray-700"},mo={value:"off"},po={value:"daily"},fo={value:"weekly"},ho={for:"current-location-name",class:"block text-sm font-medium text-gray-700"},yo={value:"home"},bo={value:"work"},_o={value:"other"},xo={for:"current-location-language",class:"block text-sm font-medium text-gray-700"},Co=["placeholder"],Lo={class:"mt-6"},wo=["disabled"],ko={key:1,class:"flex flex-col space-y-2 items-center"},So=["href"],$o={key:2,class:"mt-2 block text-sm text-red-500 text-center"},Mo={class:"text-lg font-semibold text-gray-800 mb-4"},To={class:"p-3 bg-gray-50 rounded-md shadow-sm text-sm text-gray-700 mb-4 space-y-1"},Do={key:0},Bo={class:"space-y-4"},Fo={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Go=["for"],Io=["id","onUpdate:modelValue"],Ao={value:"off"},zo={value:"daily"},Eo={value:"weekly"},No=["for"],Oo=["id","onUpdate:modelValue"],jo={value:"home"},Ro={value:"work"},Uo={value:"other"},Vo=["for"],Po=["id","onUpdate:modelValue","placeholder"],qo={class:"mt-6"},Ho=["onClick"],Wo={class:"mt-6 grid grid-cols-1 sm:grid-cols-3 gap-3"},Ko=["onClick"],Qo=["onClick"],Zo=["onClick"],Xo={key:0,class:"mt-3 text-sm text-green-600 text-center"},Yo={key:2,class:"py-6 text-center"},Jo={class:"text-md text-gray-600"},ea={__name:"SaveLocation",props:{location:{type:Object,required:!0},language_codes:{type:Array,required:!0},translations:{type:Object,required:!0}},emits:["load-location"],setup(e,{emit:m}){const h=e,g=m,c=Ae(),a=j(()=>!!c.props.auth.user),n=j(()=>window.location.pathname+window.location.search),i=B("home"),v=B(!1),x=B(!1),b=B([]),L=B("current"),_=B(!1),I=B(!1),C=B(!1),A=()=>{C.value=!C.value},z=async D=>{try{await le.post(`/locations/${D.id}/dispatch-report`),_.value=!0,setTimeout(()=>{_.value=!1},3e3)}catch(y){console.error("Error dispatching report:",y)}},F=D=>{L.value=D},$=async D=>{try{const y=await le.get("/locations");b.value=y.data,w(),D==="set"&&b.value.length&&F(b.value[0].id)}catch(y){console.error("Error fetching locations:",y)}},w=()=>{v.value=b.value.some(D=>D.latitude===location.latitude&&D.longitude===location.longitude)},o=async()=>{if(!a.value){window.location.href=route("login")+"?redirect_to="+n.value;return}x.value=!0;try{const D={name:i.value,latitude:h.location.latitude,longitude:h.location.longitude,address:h.location.address||null,report:h.location.report||"off",language:h.location.language||"English"},y=await le.post("/locations",D);b.value.push(y.data),v.value=!0,x.value=!1,I.value=!1}catch(D){D.response&&D.response.status===401?window.location.href=route("login")+"?redirect_to="+n.value:D.response&&D.response.status===403?I.value=!0:console.error("Error saving location:",D),x.value=!1}},s=async(D,y)=>{try{await le.put(`/locations/${D}`,y)}catch(S){console.error("Error updating location:",S)}},u=async D=>{try{await le.delete(`/locations/${D}`),b.value=b.value.filter(y=>y.id!==D),w(),F("current")}catch(y){console.error("Error deleting location:",y)}},M=D=>{g("load-location",D)},k=D=>D[0].toUpperCase()+D.slice(1),l=j(()=>h.language_codes[0]);return oe(()=>location,w),we(()=>{$("set"),h.location.report||(h.location.report="off",h.location.language="English")}),(D,y)=>(p(),f(X,null,[t("div",to,[t("button",{class:"text-sm font-medium text-white bg-slate-700 hover:bg-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-offset-2 py-2 px-4 rounded-md shadow-md flex items-center justify-center cursor-pointer transition-colors duration-150 ease-in-out w-full md:m-auto md:w-1/3 md:text-lg",onClick:A},[t("span",{class:ie([C.value?"rotate-0":"-rotate-90","inline-block transition-transform duration-300"])},y[4]||(y[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1)]),2),t("span",oo,r(e.translations.localizationLabelsByLanguageCode[l.value].savedLocationsTitle||"Manage Saved Locations"),1)])]),t("div",{class:ie(["w-full my-2 p-4 bg-white shadow-lg rounded-lg save-location",{hidden:!C.value,block:C.value}])},[t("div",ao,[t("button",{onClick:y[0]||(y[0]=S=>F("current")),class:ie(["px-4 py-3 text-sm font-medium leading-5 focus:outline-none transition-colors duration-150 ease-in-out",L.value==="current"?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:border-b-2"])},r(e.translations.LocationLabelsByLanguageCode[l.value].currentLocation),3),b.value.length?(p(!0),f(X,{key:0},Y(b.value,S=>(p(),f("button",{key:S.id,onClick:R=>F(S.id),class:ie(["px-4 py-3 text-sm font-medium leading-5 focus:outline-none transition-colors duration-150 ease-in-out",L.value===S.id?"text-blue-600 border-b-2 border-blue-600":"text-gray-500 hover:text-gray-700 hover:border-gray-300 hover:border-b-2"])},r(k(S.name)),11,no))),128)):P("",!0)]),t("div",so,[L.value==="current"?(p(),f("div",lo,[t("h3",io,r(e.translations.LocationLabelsByLanguageCode[l.value].currentLocation),1),t("div",ro,[t("div",null,[y[5]||(y[5]=t("strong",null,"Lat:",-1)),Z(" "+r(e.location.latitude),1)]),t("div",null,[y[6]||(y[6]=t("strong",null,"Lng:",-1)),Z(" "+r(e.location.longitude),1)]),e.location.address?(p(),f("div",co,[t("strong",null,r(e.translations.LocationLabelsByLanguageCode[l.value].address)+":",1),Z(" "+r(e.location.address),1)])):P("",!0)]),t("div",uo,[t("div",go,[t("div",null,[t("label",vo,r(e.translations.LocationLabelsByLanguageCode[l.value].report),1),se(t("select",{id:"current-location-report","onUpdate:modelValue":y[1]||(y[1]=S=>e.location.report=S),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[t("option",mo,r(e.translations.LocationLabelsByLanguageCode[l.value].off),1),t("option",po,r(e.translations.LocationLabelsByLanguageCode[l.value].daily),1),t("option",fo,r(e.translations.LocationLabelsByLanguageCode[l.value].weekly),1)],512),[[ke,e.location.report]])]),t("div",null,[t("label",ho,r(e.translations.LocationLabelsByLanguageCode[l.value].selectName),1),se(t("select",{id:"current-location-name","onUpdate:modelValue":y[2]||(y[2]=S=>i.value=S),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[t("option",yo,r(e.translations.LocationLabelsByLanguageCode[l.value].home),1),t("option",bo,r(e.translations.LocationLabelsByLanguageCode[l.value].work),1),t("option",_o,r(e.translations.LocationLabelsByLanguageCode[l.value].other),1)],512),[[ke,i.value]])])]),t("div",null,[t("label",xo,r(e.translations.LocationLabelsByLanguageCode[l.value].language),1),se(t("input",{type:"text",id:"current-location-language","onUpdate:modelValue":y[3]||(y[3]=S=>e.location.language=S),class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:e.translations.LocationLabelsByLanguageCode[l.value].language},null,8,Co),[[Se,e.location.language]])]),t("div",Lo,[a.value?(p(),f("button",{key:0,onClick:o,class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",disabled:x.value},r(x.value?e.translations.LocationLabelsByLanguageCode[l.value].saving:e.translations.LocationLabelsByLanguageCode[l.value].saveLocation),9,wo)):(p(),f("div",ko,[t("a",{href:D.route("socialite.redirect","google")+"?redirect_to="+n.value,class:"flex items-center justify-center w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"},[y[7]||(y[7]=t("img",{class:"h-5 w-5 mr-2",src:"https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg",alt:"Google logo"},null,-1)),Z(" "+r(e.translations.LocationLabelsByLanguageCode[l.value].loginWithGoogleToSave||"Login with Google to Save"),1)],8,So),V(te(be),{href:D.route("login")+"?redirect_to="+n.value,class:"text-sm text-blue-600 hover:underline"},{default:ge(()=>[Z(r(e.translations.LocationLabelsByLanguageCode[l.value].loginManuallyToSave||"Or login manually to save"),1)]),_:1},8,["href"])])),I.value&&a.value?(p(),f("span",$o,r(e.translations.LocationLabelsByLanguageCode[l.value].maxLocationsReached),1)):P("",!0)])])])):b.value.length?(p(!0),f(X,{key:1},Y(b.value,S=>se((p(),f("div",{key:S.id,class:"saved-location"},[t("h3",Mo,r(k(S.name))+" - "+r(e.translations.LocationLabelsByLanguageCode[l.value].savedLocation),1),t("div",To,[t("div",null,[y[8]||(y[8]=t("strong",null,"Lat:",-1)),Z(" "+r(S.latitude),1)]),t("div",null,[y[9]||(y[9]=t("strong",null,"Lng:",-1)),Z(" "+r(S.longitude),1)]),S.address?(p(),f("div",Do,[t("strong",null,r(e.translations.LocationLabelsByLanguageCode[l.value].address)+":",1),Z(" "+r(S.address),1)])):P("",!0)]),t("div",Bo,[t("div",Fo,[t("div",null,[t("label",{for:"saved-location-report-"+S.id,class:"block text-sm font-medium text-gray-700"},r(e.translations.LocationLabelsByLanguageCode[l.value].report),9,Go),se(t("select",{id:"saved-location-report-"+S.id,"onUpdate:modelValue":R=>S.report=R,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[t("option",Ao,r(e.translations.LocationLabelsByLanguageCode[l.value].off),1),t("option",zo,r(e.translations.LocationLabelsByLanguageCode[l.value].daily),1),t("option",Eo,r(e.translations.LocationLabelsByLanguageCode[l.value].weekly),1)],8,Io),[[ke,S.report]])]),t("div",null,[t("label",{for:"saved-location-name-"+S.id,class:"block text-sm font-medium text-gray-700"},r(e.translations.LocationLabelsByLanguageCode[l.value].selectName),9,No),se(t("select",{id:"saved-location-name-"+S.id,"onUpdate:modelValue":R=>S.name=R,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"},[t("option",jo,r(e.translations.LocationLabelsByLanguageCode[l.value].home),1),t("option",Ro,r(e.translations.LocationLabelsByLanguageCode[l.value].work),1),t("option",Uo,r(e.translations.LocationLabelsByLanguageCode[l.value].other),1)],8,Oo),[[ke,S.name]])])]),t("div",null,[t("label",{for:"saved-location-language-"+S.id,class:"block text-sm font-medium text-gray-700"},r(e.translations.LocationLabelsByLanguageCode[l.value].language),9,Vo),se(t("input",{type:"text",id:"saved-location-language-"+S.id,"onUpdate:modelValue":R=>S.language=R,class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",placeholder:e.translations.LocationLabelsByLanguageCode[l.value].language},null,8,Po),[[Se,S.language]])]),t("div",qo,[t("button",{onClick:R=>s(S.id,S),class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},r(e.translations.LocationLabelsByLanguageCode[l.value].update),9,Ho)])]),t("div",Wo,[t("button",{onClick:R=>M(S),class:"w-full flex justify-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},r(e.translations.LocationLabelsByLanguageCode[l.value].load),9,Ko),t("button",{onClick:R=>u(S.id),class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"},r(e.translations.LocationLabelsByLanguageCode[l.value].delete),9,Qo),t("button",{onClick:R=>z(S),class:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"},r(e.translations.LocationLabelsByLanguageCode[l.value].sendReport),9,Zo)]),_.value&&L.value===S.id?(p(),f("div",Xo,r(e.translations.LocationLabelsByLanguageCode[l.value].reportSent),1)):P("",!0)])),[[qe,L.value===S.id]])),128)):L.value!=="current"&&!b.value.find(S=>S.id===L.value)?(p(),f("div",Yo,[t("p",Jo,r(e.translations.LocationLabelsByLanguageCode[l.value].noSavedLocations),1)])):P("",!0)])],2)],64))}},ta=he(ea,[["__scopeId","data-v-aab0bdc4"]]),oa={class:"text-2xl font-bold text-center text-gray-800 mb-4"},aa={class:"text-center text-gray-600 mb-6"},na={key:0,class:"p-4 bg-green-50 border border-green-300 rounded-lg shadow text-center mb-6"},sa={class:"font-bold text-green-800"},la={class:"text-green-700"},ia={key:1,class:"p-4 bg-blue-50 border border-blue-300 rounded-lg shadow text-center mb-6"},ra={class:"font-bold text-blue-800"},ca={class:"text-blue-700"},ua={key:2,class:"p-4 bg-gray-100 rounded-lg shadow text-center mb-6"},da={class:"font-bold text-gray-800"},ga={class:"text-gray-600"},va={class:"mb-2"},ma={class:"p-2 md:p-4 border rounded-lg shadow hover:shadow-lg transition-shadow bg-white mb-2 md:mb-4"},pa={class:"grid grid-cols-2 gap-2 md:gap-4"},fa={class:"p-2 md:p-4 border rounded-lg shadow hover:shadow-lg transition-shadow bg-white"},ha={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 md:h-5 md:w-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor"},ya={key:1,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 md:h-5 md:w-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor"},ba={class:""},_a={key:2,class:"text-center text-xs md:text-sm animate-pulse"},xa={class:"p-2 md:p-4 border rounded-lg shadow hover:shadow-lg transition-shadow bg-white"},Ca=["disabled"],La={class:""},wa={key:0,class:"text-red-500 text-xs md:text-sm text-center mt-1 md:mt-2"},ka={__name:"CenterManagement",props:{centralLocation:Object,tempNewCenterForDisplay:Object,isCenterSelectionActive:Boolean,language_codes:Array,translations:Object,singleLanguageCode:String},emits:["toggle-center-selection-mode","address-search-coordinates-selected","load-saved-location"],setup(e,{emit:m}){const h=e,g=m,c=j(()=>h.singleLanguageCode||"en-US"),a=B(!1),n=B(null),i=()=>{var L;navigator.geolocation?(a.value=!0,n.value=null,navigator.geolocation.getCurrentPosition(_=>{const I={lat:_.coords.latitude,lng:_.coords.longitude};g("address-search-coordinates-selected",I),a.value=!1},_=>{var C,A,z,F;console.error("Geolocation error: ",_);let I=((C=translations.localizationLabelsByLanguageCode[c.value])==null?void 0:C.geolocationGenericError)||"Could not retrieve your location.";_.code===_.PERMISSION_DENIED?I=((A=translations.localizationLabelsByLanguageCode[c.value])==null?void 0:A.geolocationPermissionDeniedError)||"Permission denied. Please enable location services in your browser settings.":_.code===_.POSITION_UNAVAILABLE?I=((z=translations.localizationLabelsByLanguageCode[c.value])==null?void 0:z.geolocationPositionUnavailableError)||"Location information is unavailable.":_.code===_.TIMEOUT&&(I=((F=translations.localizationLabelsByLanguageCode[c.value])==null?void 0:F.geolocationTimeoutError)||"The request to get user location timed out."),n.value=I,a.value=!1})):n.value=((L=translations.localizationLabelsByLanguageCode[c.value])==null?void 0:L.geolocationNotSupportedError)||"Geolocation is not supported by this browser."},v=L=>{n.value=null,g("address-search-coordinates-selected",L)},x=()=>{g("toggle-center-selection-mode")},b=L=>{g("load-saved-location",L)};return(L,_)=>(p(),f("div",null,[t("h2",oa,r(e.translations.localizationLabelsByLanguageCode[c.value].setYourHubTitle||"Pinpoint Your Hub!"),1),t("p",aa,r(e.translations.localizationLabelsByLanguageCode[c.value].setYourHubDescription||"Set your central location to personalize your map experience. Choose your preferred method below:"),1),e.tempNewCenterForDisplay?(p(),f("div",na,[t("p",sa,r(e.translations.localizationLabelsByLanguageCode[c.value].newCenterPreviewTitle||"New Center Preview:"),1),t("p",la,r(e.tempNewCenterForDisplay.lat)+", "+r(e.tempNewCenterForDisplay.lng),1)])):e.centralLocation&&e.centralLocation.latitude&&e.centralLocation.longitude?(p(),f("div",ia,[t("p",ra,r(e.translations.localizationLabelsByLanguageCode[c.value].currentSavedCenterTitle||"Current Saved Center:"),1),t("p",ca,r(e.centralLocation.latitude)+", "+r(e.centralLocation.longitude),1)])):(p(),f("div",ua,[t("p",da,r(e.translations.localizationLabelsByLanguageCode[c.value].noCenterSetTitle||"No central location set yet."),1),t("p",ga,r(e.translations.localizationLabelsByLanguageCode[c.value].setupPrompt||"Let's get one set up!"),1)])),t("div",va,[t("div",ma,[V(eo,{onAddressSelected:v,language_codes:e.language_codes,placeholder_text:e.translations.localizationLabelsByLanguageCode[c.value].searchAddressPlaceholder||"Search for an address"},null,8,["language_codes","placeholder_text"])]),t("div",pa,[t("div",fa,[t("button",{type:"button",onClick:x,class:ie(["w-full h-full px-2 py-2 text-xs sm:text-sm md:px-4 md:py-3 md:text-base text-white rounded-lg shadow-md transition-colors flex items-center justify-center space-x-1 md:space-x-2",e.isCenterSelectionActive?"bg-red-500 hover:bg-red-600":"bg-teal-500 hover:bg-teal-600"])},[e.isCenterSelectionActive?(p(),f("svg",ya,_[1]||(_[1]=[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L10 8.586 7.707 6.293a1 1 0 00-1.414 1.414L8.586 10l-2.293 2.293a1 1 0 001.414 1.414L10 11.414l2.293 2.293a1 1 0 001.414-1.414L11.414 10l2.293-2.293z","clip-rule":"evenodd"},null,-1)]))):(p(),f("svg",ha,_[0]||(_[0]=[t("path",{d:"M17.293 3.293A1 1 0 0118 4v12a1 1 0 01-1.707.707L10 10.414l-6.293 6.293A1 1 0 012 16V4a1 1 0 011.707-.707L10 9.586l6.293-6.293a1 1 0 011.000 0z","clip-rule":"evenodd"},null,-1)]))),t("span",ba,r(e.isCenterSelectionActive?e.translations.localizationLabelsByLanguageCode[c.value].cancelMapSelectionButton||"Cancel Map Selection":e.translations.localizationLabelsByLanguageCode[c.value].selectByMapClickButton||"Select by Map Click"),1),e.isCenterSelectionActive?(p(),f("p",_a,r(e.translations.localizationLabelsByLanguageCode[c.value].clickOnMapInstruction||"Click on the map to choose your center!"),1)):P("",!0)],2)]),t("div",xa,[t("button",{type:"button",onClick:i,disabled:a.value,class:"w-full h-full px-2 py-2 text-xs sm:text-sm md:px-4 md:py-3 md:text-base text-white bg-blue-600 rounded-lg shadow-md hover:bg-indigo-700 transition-colors flex items-center justify-center space-x-1 md:space-x-2 disabled:bg-gray-400"},[_[2]||(_[2]=t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 md:h-5 md:w-5 flex-shrink-0",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z","clip-rule":"evenodd"})],-1)),t("span",La,r(a.value?e.translations.localizationLabelsByLanguageCode[c.value].locatingButton||"Locating...":e.translations.localizationLabelsByLanguageCode[c.value].useCurrentLocationButton||"Use My Current Location"),1)],8,Ca),n.value?(p(),f("p",wa,r(n.value),1)):P("",!0)])])]),V(ta,{location:e.centralLocation,language_codes:e.language_codes,onLoadLocation:b,translations:e.translations},null,8,["location","language_codes","translations"])]))}};const Sa={__name:"MapDisplay",props:{mapCenterCoordinates:Array,allMapDataPoints:Array,activeFilterTypes:Object,isCenterSelectionModeActive:Boolean,tempNewMarkerPlacementCoords:Object,mapIsLoading:Boolean,shouldClearTempMarker:Boolean,mapConfiguration:Object},emits:["map-coordinates-selected-for-new-center","marker-data-point-clicked","map-initialized-internal"],setup(e,{expose:m,emit:h}){const g=e,c=h,a=B(null),n=B(null),i=B(null),v=B({}),x=B({center:g.mapCenterCoordinates&&g.mapCenterCoordinates.length===2?g.mapCenterCoordinates:[42.3601,-71.0589],zoom:16}),b=o=>{let s="default-div-icon",u=o.alcivartech_type,M="";const k=tt(o);switch(u){case"Crime":s="crime-div-icon";break;case"311 Case":s="case-div-icon";break;case"Building Permit":s="permit-div-icon";break;case"Property Violation":s="property-violation-div-icon";break;case"Construction Off Hour":s="construction-off-hour-div-icon";break;case"Food Inspection":s="food-inspection-div-icon";break;case"Car Crash":s="crash-div-icon";break}if(k.className&&(s+=` ${k.className}`),u==="311 Case"){if(o!=null&&o.submitted_photo){const l=o.submitted_photo.split(" | ")[0];s+=" submitted-photo",M=`background-image: url(${l});`}if(o!=null&&o.closed_photo){const l=o.closed_photo.split(" | ")[0];s+=" closed-photo",M=`background-image: url(${l});`}!(o!=null&&o.submitted_photo)&&!(o!=null&&o.closed_photo)&&(s+=" no-photo")}return s+=" id"+(o==null?void 0:o.data_point_id),ee.divIcon({className:s,html:`<div style="${M}"></div>`,iconSize:null,popupAnchor:[0,-15]})},L=o=>{let s="center-div-icon";return o==="NewCenter"&&(s="new-center-div-icon"),ee.divIcon({className:s,html:"<div></div>",iconSize:null,popupAnchor:[0,-15]})},_=o=>o<10?80:o<13?60:o<16?40:10,I=o=>function(s){const u=s.getChildCount();let M="marker-cluster";const k=o==="Unknown"||!o?"mixed":o.toLowerCase().replace(/\s+/g,"-").replace(/[()]/g,"");return M+=` cluster-${k}`,u<10?M+=" marker-cluster-small":u<100?M+=" marker-cluster-medium":M+=" marker-cluster-large",ee.divIcon({html:`<div><span>${u}</span></div>`,className:M,iconSize:ee.point(40,40)})},C=(o,s=null)=>{var S,R;const u=document.createElement("div");u.className="custom-popup-content individual-item-popup",u.style.maxHeight="350px",u.style.overflowY="auto",u.style.paddingRight="10px";const M=o.alcivartech_model,k=(R=(S=g.mapConfiguration)==null?void 0:S.dataPointModelConfig)==null?void 0:R[M],l=o[(k==null?void 0:k.dataObjectKey)||M];let y=`<div style="margin-bottom: 5px;"><strong>${new Date(o.alcivartech_date).toLocaleString()}</strong></div>`;if(y+=`<div>Type: ${o.alcivartech_type||"N/A"}</div>`,M&&M.replace(/_/g," ").toLowerCase()!==o.alcivartech_type.toLowerCase()&&(y+=`<div>Source Model: ${M.replace(/_/g," ").replace(/\b\w/g,O=>O.toUpperCase())}</div>`),l!=null&&l.violation_summary){console.log("Creating custom popup for aggregated food inspections:",o);let O=`<div style="margin-bottom: 5px;"><strong>${new Date(l.alcivartech_date||o.alcivartech_date).toLocaleString()}</strong> (Most Recent Activity)</div>`;O+=`<div>Type: ${o.alcivartech_type}</div>`,l.businessname&&(O+=`<div style="font-size: 1.1em; margin-bottom: 3px;"><strong>Business: ${l.businessname}</strong></div>`),l.licenseno&&(O+=`<div>License: ${l.licenseno}</div>`),l.address&&(O+=`<div>Address: ${l.address}</div>`),u.innerHTML=O;const E=document.createElement("div");E.style.marginTop="10px",E.style.marginBottom="5px";const J=l.violation_summary.reduce((U,re)=>U+re.entries.length,0);E.innerHTML=`<strong>Violation History (${J} total records):</strong>`,u.appendChild(E);const H=document.createElement("div");return H.style.paddingRight="5px",l.violation_summary.forEach(U=>{const re=document.createElement("div");re.style.marginTop="8px",re.style.paddingLeft="5px";const _e=U.entries[0],Me=_e.viol_status==="Fail"||_e.result&&_e.result.toLowerCase().includes("fail")?"#D32F2F":"#388E3C";re.innerHTML=`<strong style="color: ${Me};">${U.violdesc}</strong> (${U.entries.length} record(s))`,H.appendChild(re);const ce=document.createElement("ul");ce.style.listStylePosition="inside",ce.style.paddingLeft="10px",ce.style.marginLeft="0px",U.entries.forEach(q=>{const ue=document.createElement("li");ue.style.fontSize="0.9em",ue.style.marginBottom="6px",ue.style.borderBottom="1px dashed #eee",ue.style.paddingBottom="4px";let ye=`<div style="font-weight: bold;"><em>${new Date(q.alcivartech_date).toLocaleString()}</em></div>`;const Te=q.viol_status==="Fail"||q.result&&q.result.toLowerCase().includes("fail")?"red":"green";ye+=`<div>Status: <span style="font-weight:bold; color: ${Te};">${q.viol_status||"N/A"}</span> | Result: ${q.result||"N/A"} | Level: ${q.viol_level||"N/A"}</div>`,q.comments&&(q.viol_status==="Pass"||q.result&&q.result.toLowerCase().includes("pass")?ye+=`<div style="font-style: italic; color: #222; margin-top: 2px;">Comments addressed from previous failed inspection: ${q.comments}</div>`:ye+=`<div style="font-style: italic; color: #222; margin-top: 2px;">Comments: ${q.comments}</div>`),ue.innerHTML=ye,ce.appendChild(ue)}),ce.lastChild&&(ce.lastChild.style.borderBottom="none"),H.appendChild(ce)}),u.appendChild(H),u}else k&&l?(k.mainIdentifierField&&l[k.mainIdentifierField]&&(y+=`<div><strong>${k.mainIdentifierLabel||"ID"}:</strong> ${l[k.mainIdentifierField]}</div>`),k.descriptionField&&l[k.descriptionField]&&(y+=`<div><strong>${k.descriptionLabel||"Description"}:</strong> ${l[k.descriptionField]}</div>`),k.additionalFields&&Array.isArray(k.additionalFields)&&k.additionalFields.forEach(O=>{const E=l[O.key];let J=!0;O.condition&&(O.condition==="boolean_true_only"&&E!==!0&&String(E).toLowerCase()!=="true"||O.condition==="not_empty_string"&&(E===null||String(E).trim()===""))&&(J=!1),J&&E!==void 0&&E!==null&&(y+=`<div><strong>${O.label||O.key}:</strong> ${E}</div>`)}),o.live_details&&(y+='<div style="margin-top: 5px; padding-top: 5px; border-top: 1px solid #eee;"><strong>Live Details:</strong></div>',Object.entries(o.live_details).forEach(([O,E])=>{const J=O.replace(/_/g," ").replace(/\b\w/g,U=>U.toUpperCase());let H=E;typeof E=="object"&&E!==null?H=JSON.stringify(E):E==null&&(H="N/A"),y+=`<div>${J}: ${H}</div>`})),u.innerHTML=y):l?(Object.entries(l).forEach(([O,E])=>{const J=O.replace(/_/g," ").replace(/\b\w/g,U=>U.toUpperCase());let H=E;typeof E=="object"&&E!==null?H=JSON.stringify(E):E==null&&(H="N/A"),y+=`<div>${J}: ${H}</div>`}),u.innerHTML=y):(y+=`<div>No detailed data available for this point. Model: ${M}</div>`,u.innerHTML=y);return u},A=(o=null,s=!1)=>{je(()=>{if(a.value){console.warn("MapDisplay: initializeMapInternal called while map instance already exists. Aborting.");return}o&&s&&(x.value.center=o);const u=x.value.center,M=x.value.zoom;if(a.value=fe(ee.map("map").setView(u,M)),ee.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'© <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(a.value),!a.value){console.error("MapDisplay: Map initialization failed.");return}const k=()=>{if(!a.value)return;a.value.invalidateSize();const l=a.value.getZoom(),D=2,y=50,S=a.value.getMinZoom()||10,R=a.value.getMaxZoom()||19;let O;l<=S?O=D:l>=R?O=y:O=R-S>0?D+(y-D)*(l-S)/(R-S):D,document.documentElement.style.setProperty("--icon-size",`${O}px`)};a.value.on("zoomend",k),a.value.on("resize",()=>{a.value&&(a.value.invalidateSize(),k())}),k(),a.value.on("click",l=>{g.isCenterSelectionModeActive&&c("map-coordinates-selected-for-new-center",l.latlng)}),g.mapCenterCoordinates&&g.mapCenterCoordinates.length===2&&(n.value=fe(ee.marker(g.mapCenterCoordinates,{icon:L("Center")})).addTo(a.value)),c("map-initialized-internal"),g.allMapDataPoints&&F(g.allMapDataPoints),g.tempNewMarkerPlacementCoords&&i.value==null&&(i.value=fe(ee.marker([g.tempNewMarkerPlacementCoords.lat,g.tempNewMarkerPlacementCoords.lng],{icon:L("NewCenter")})).addTo(a.value))})},z=()=>{a.value&&(x.value={center:a.value.getCenter(),zoom:a.value.getZoom()},a.value.off(),a.value.remove(),a.value=null,Object.values(v.value).forEach(o=>{o.clearLayers(),a.value&&a.value.hasLayer(o)&&a.value.removeLayer(o)}),v.value={},n.value&&(n.value.remove(),n.value=null),i.value&&(i.value.remove(),i.value=null))},F=o=>{if(a.value){if(Object.values(v.value).forEach(s=>{a.value.hasLayer(s)&&a.value.removeLayer(s),s.clearLayers()}),v.value={},!o||o.length===0){$();return}o.forEach(s=>{if(!s.latitude||!s.longitude){console.warn("Skipping data point due to invalid coordinates:",s);return}const u=parseFloat(s.latitude),M=parseFloat(s.longitude),k=s.alcivartech_type||"Unknown";if(isNaN(u)||isNaN(M)){console.warn("Skipping data point due to invalid parsed coordinates:",s);return}if(!v.value[k]){const y=fe(ee.markerClusterGroup({maxClusterRadius:_,iconCreateFunction:I(k)}));v.value[k]=y}const l=fe(ee.marker([u,M],{icon:b(s)})),D=C(s,null);l.bindPopup(D,{minWidth:220}),l.on("click",y=>{c("marker-data-point-clicked",s)}),v.value[k].addLayer(l)}),$()}},$=()=>{if(!a.value)return;const o=g.activeFilterTypes||{};Object.entries(v.value).forEach(([s,u])=>{o[s]?a.value.hasLayer(u)||a.value.addLayer(u):a.value.hasLayer(u)&&a.value.removeLayer(u)})};return oe(()=>g.mapCenterCoordinates,(o,s)=>{a.value&&o&&o.length===2?n.value?n.value.setLatLng(o):n.value=fe(ee.marker(o,{icon:L("Center")})).addTo(a.value):a.value&&!o&&n.value&&(a.value.removeLayer(n.value),n.value=null)},{deep:!0}),oe(()=>g.allMapDataPoints,o=>{a.value&&o&&F(o)},{deep:!0}),oe(()=>g.activeFilterTypes,()=>{a.value&&$()},{deep:!0}),oe(()=>g.tempNewMarkerPlacementCoords,o=>{a.value&&(i.value&&(a.value.removeLayer(i.value),i.value=null),o&&(i.value=fe(ee.marker([o.lat,o.lng],{icon:L("NewCenter")})).addTo(a.value)))}),oe(()=>g.shouldClearTempMarker,o=>{o&&i.value&&a.value&&(a.value.removeLayer(i.value),i.value=null)}),we(()=>{x.value={center:g.mapCenterCoordinates&&g.mapCenterCoordinates.length===2?g.mapCenterCoordinates:[42.3601,-71.0589],zoom:16},A()}),He(()=>{z()}),m({destroyMapAndClear:z,initializeNewMapAtCenter:A,getMapInstance:()=>a.value,getMarkers:()=>{let o=[];return Object.values(v.value).forEach(s=>{o=o.concat(s.getLayers())}),o}}),(o,s)=>(p(),f("div",{class:ie(["boston-map",{"map-loading":e.mapIsLoading}])},s[0]||(s[0]=[t("div",{id:"map",class:"h-full"},null,-1)]),2))}},$a=he(Sa,[["__scopeId","data-v-a1dd5f17"]]);const Ma={class:"map-controls bg-gray-50 p-3 shadow-lg rounded-lg max-h-[70vh] overflow-y-auto"},Ta={class:"filter-type-container mb-4"},Da={class:"text-sm font-semibold text-gray-700 mb-2"},Ba={class:"flex flex-row flex-wrap gap-2"},Fa=["onClick","title"],Ga={class:"filter-button-text break-all hidden lg:inline ml-1"},Ia={class:"date-filter-container"},Aa={class:"text-sm font-semibold text-gray-700 mb-2"},za={class:"date-buttons-scroll-container overflow-y-auto space-y-1 pr-1"},Ea=["onClick"],Na={__name:"MapFiltersControl",props:{initialFilterTypeState:Object,initialSelectedDates:Array,minDateForFilter:String,maxDateForFilter:String,translations:Object,singleLanguageCode:String},emits:["filters-updated"],setup(e,{emit:m}){const h=e,g=m,c=B({}),a=B([]),n=j(()=>h.singleLanguageCode||"en-US");we(()=>{c.value={...h.initialFilterTypeState},a.value=[...h.initialSelectedDates]}),oe(()=>h.initialFilterTypeState,C=>{c.value={...C}},{deep:!0}),oe(()=>h.initialSelectedDates,C=>{a.value=[...C]},{deep:!0});const i=j(()=>{if(!h.minDateForFilter||!h.maxDateForFilter)return[];const C=[],A=new Date(h.minDateForFilter),z=new Date(h.maxDateForFilter);for(;A<=z;)C.push(new Date(A).toISOString().split("T")[0]),A.setDate(A.getDate()+1);return C.sort((F,$)=>new Date($)-new Date(F)),C});j(()=>{const C=Object.keys(c.value).length;return C>4?"sm:w-1/3 md:w-1/4":C>2?"sm:w-1/2 md:w-1/3":"w-full sm:w-1/2"});const v=C=>{var A,z,F;return((F=(z=(A=h.translations)==null?void 0:A.dataTypeMapByLanguageCode)==null?void 0:z[n.value])==null?void 0:F[C])||C},x=(C,A,z)=>{if(!C)return"";const F=C.split("-");if(F.length!==3)return console.warn("Invalid date string format for displayLocalDateFromUtcString:",C),C;const $=parseInt(F[0],10),w=parseInt(F[1],10)-1,o=parseInt(F[2],10);return isNaN($)||isNaN(w)||isNaN(o)?(console.warn("Invalid date components after parsing for displayLocalDateFromUtcString:",C),C):new Date(Date.UTC($,w,o,12,0,0)).toLocaleDateString(A,z)},b=C=>{c.value[C]=!c.value[C],I()},L=C=>{const A=a.value.indexOf(C);A>-1?a.value.splice(A,1):a.value.push(C),I()},_=()=>{a.value=[],I()},I=()=>{g("filters-updated",{activeTypes:{...c.value},selectedDates:[...a.value]})};return oe([c,a],()=>{},{deep:!0}),(C,A)=>{var z,F,$;return p(),f("div",Ma,[t("div",Ta,[t("h3",Da,r(((z=e.translations.localizationLabelsByLanguageCode[n.value])==null?void 0:z.filterByTypeTitle)||"Filter by Type"),1),t("div",Ba,[(p(!0),f(X,null,Y(c.value,(w,o)=>(p(),f("button",{key:o,onClick:s=>b(o),class:ie([["filter-button",w?"active":"inactive",`${o.toLowerCase().replace(/\s/g,"-").replace(/\d/g,"a")}-filter-button`],"flex-grow basis-1/3 md:basis-1/4 lg:basis-auto p-2 rounded-md text-xs font-medium transition-all duration-150 ease-in-out focus:outline-none focus:ring-2 focus:ring-opacity-50"]),title:v(o)},[A[0]||(A[0]=t("span",{class:"filter-button-icon"},null,-1)),t("span",Ga,r(v(o)),1)],10,Fa))),128))])]),t("div",Ia,[t("h3",Aa,r(((F=e.translations.localizationLabelsByLanguageCode[n.value])==null?void 0:F.filterByDateTitle)||"Filter by Date"),1),t("button",{onClick:_,class:"w-full px-3 py-2 mb-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors text-xs font-semibold shadow"},r((($=e.translations.localizationLabelsByLanguageCode[n.value])==null?void 0:$.allDatesButton)||"Show All Dates"),1),t("div",za,[(p(!0),f(X,null,Y(i.value,(w,o)=>(p(),f("button",{key:o,onClick:s=>L(w),class:ie([{"bg-indigo-500 text-white shadow-md":a.value.includes(w),"bg-gray-200 text-gray-700 hover:bg-gray-300":!a.value.includes(w)},"w-full px-3 py-2 rounded-md transition-colors text-xs text-left"])},r(x(w,n.value,{weekday:"short",month:"short",day:"numeric"})),11,Ea))),128))])])])}}},Oa=he(Na,[["__scopeId","data-v-43752012"]]);const ja={class:"p-4 border rounded-md shadow-sm bg-white mt-4"},Ra={class:"mb-4 p-2 border-b"},Ua={class:"font-medium text-md"},Va={class:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-1 mt-1"},Pa=["id","value","onUpdate:modelValue"],qa=["for"],Ha={key:0},Wa={class:"font-medium text-sm"},Ka={class:"list-disc list-inside text-sm pl-4 mt-1"},Qa={class:"font-semibold"},Za={key:1,class:"text-gray-500 text-sm"},Xa={__name:"DataPointStatistics",props:{dataPoints:{type:Array,default:()=>[]},mapConfiguration:{type:Object,default:()=>({})}},setup(e){const m=e,h=B({}),g=j(()=>{var x;const i={};return!((x=m.mapConfiguration)!=null&&x.dataPointModelConfig)||!m.dataPoints||[...new Set(m.dataPoints.map(b=>b.alcivartech_model))].forEach(b=>{const L=m.mapConfiguration.dataPointModelConfig[b];L&&L.filterFieldsDescription&&(i[b]={displayTitle:L.displayTitle,fields:L.filterFieldsDescription.filter(_=>_.name!=="search_term"&&!_.name.endsWith("_min")&&!_.name.endsWith("_max")&&!_.name.endsWith("_start")&&!_.name.endsWith("_end"))},h.value[b]||(h.value[b]=[]))}),i}),c=j(()=>{var x;const i={},v=(x=m.mapConfiguration)==null?void 0:x.dataPointModelConfig;if(!v)return{};for(const b in h.value){const L=h.value[b];if(L.length===0)continue;i[b]={};const _=v[b],I=_.dataObjectKey;L.forEach(C=>{const A=_.filterFieldsDescription.find($=>$.name===C);if(!A)return;const z={},F=m.dataPoints.filter($=>$.alcivartech_model===b&&$[I]);if(A.type==="number"){const $=F.map(s=>s[I][C]).filter(s=>s!=null).map(Number);if($.length===0)return;const w=Math.min(...$),o=Math.max(...$);if(w===o)z[w]=$.length;else{const u=(o-w)/5,M=Array.from({length:5},(k,l)=>{const D=w+l*u,y=D+u;return{name:`${D.toFixed(1)} - ${y.toFixed(1)}`,count:0}});$.forEach(k=>{let l=Math.floor((k-w)/u);k===o&&(l=5-1),M[l]&&M[l].count++}),M.forEach(k=>{k.count>0&&(z[k.name]=k.count)})}}else F.forEach($=>{const w=$[I][C];if(Array.isArray(w))w.forEach(o=>{const s=String(o);z[s]=(z[s]||0)+1});else{const o=String(w);z[o]=(z[o]||0)+1}});Object.keys(z).length>0&&(i[b][C]=Object.fromEntries(Object.entries(z).sort(([,$],[,w])=>w-$)))})}return i}),a=j(()=>Object.values(c.value).some(i=>Object.keys(i).length>0));function n(i,v){var b;const x=(b=g.value[i])==null?void 0:b.fields.find(L=>L.name===v);return(x==null?void 0:x.label)||v}return(i,v)=>(p(),f("div",ja,[v[1]||(v[1]=t("h4",{class:"text-lg font-semibold mb-3"},"Data Statistics",-1)),t("div",Ra,[v[0]||(v[0]=t("h5",{class:"font-semibold mb-2"},"Select fields to analyze:",-1)),(p(!0),f(X,null,Y(g.value,(x,b)=>(p(),f("div",{key:b,class:"mb-3"},[t("label",Ua,r(x.displayTitle),1),t("div",Va,[(p(!0),f(X,null,Y(x.fields,L=>(p(),f("div",{key:L.name,class:"flex items-center"},[se(t("input",{type:"checkbox",id:`stat-field-${b}-${L.name}`,value:L.name,"onUpdate:modelValue":_=>h.value[b]=_,class:"mr-2 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,8,Pa),[[We,h.value[b]]]),t("label",{for:`stat-field-${b}-${L.name}`,class:"text-sm select-none"},r(L.label),9,qa)]))),128))])]))),128))]),a.value?(p(),f("div",Ha,[(p(!0),f(X,null,Y(c.value,(x,b)=>(p(),f("div",{key:b,class:"mb-4"},[(p(!0),f(X,null,Y(x,(L,_)=>(p(),f("div",{key:_,class:"mb-3"},[t("h6",Wa,r(n(b,_)),1),t("ul",Ka,[(p(!0),f(X,null,Y(L,(I,C)=>(p(),f("li",{key:C},[t("span",Qa,r(C===null||C===""?"N/A":C),1),Z(": "+r(I),1)]))),128))])]))),128))]))),128))])):(p(),f("div",Za,"Select one or more fields above to see statistics."))]))}};const Ya={key:0,class:"bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 rounded-lg shadow-lg my-6"},Ja={class:"container mx-auto"},en={key:0},tn={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 text-sm"},on={class:"font-semibold text-white truncate"},an={key:0,class:"text-xs text-blue-200 truncate"},nn={class:"text-xs text-blue-300 mt-1"},sn={class:"mt-4 text-center flex justify-center items-center flex-wrap gap-3"},ln={key:1,class:"text-center"},rn={class:"flex justify-center items-center flex-wrap gap-3"},cn={__name:"FeaturedUserMapsBanner",setup(e){const m=Ae(),h=j(()=>m.props.featuredMaps||[]),g=j(()=>{var n;return h.value.length>0||!((n=m.props.auth)!=null&&n.user)}),c=n=>{Ke("click",{event_category:"engagement",event_label:n||"featured_user_maps_banner_click",value:1})},a=(n,i=!1)=>{const v=(n==null?void 0:n.toLowerCase())||"";return v.includes("pro")?i?"bg-purple-400 text-purple-50":"bg-purple-100 text-purple-800":v.includes("basic")?i?"bg-green-400 text-green-50":"bg-green-100 text-green-800":v.includes("free")?i?"bg-blue-400 text-blue-50":"bg-blue-100 text-blue-800":i?"bg-gray-600 text-gray-50":"bg-gray-100 text-gray-800"};return(n,i)=>g.value&&(h.value.length>0||!n.$page.props.auth.user)?(p(),f("div",Ya,[t("div",Ja,[h.value.length>0?(p(),f("div",en,[i[6]||(i[6]=t("h3",{class:"text-xl font-semibold mb-2"},"Featured Community Maps!",-1)),t("div",tn,[(p(!0),f(X,null,Y(h.value,v=>(p(),f("div",{key:v.id,class:"bg-blue-800 p-3 rounded-md hover:bg-blue-900 transition-colors"},[V(te(be),{href:n.route("saved-maps.view",v.id),class:"block"},{default:ge(()=>{var x;return[t("h4",on,r(v.name),1),v.description?(p(),f("p",an,r(v.description),1)):P("",!0),t("p",nn,[Z(" By: "+r(v.creator_display_name||((x=v.user)==null?void 0:x.name)||"Community Member")+" ",1),v.creator_tier_display_name?(p(),f("span",{key:0,class:ie(["ml-1 px-1 py-0.25 rounded-full text-xs",a(v.creator_tier_name,!1)])},r(v.creator_tier_display_name),3)):P("",!0)])]}),_:2},1032,["href"])]))),128))]),t("div",sn,[V(te(be),{href:n.route("saved-maps.index"),class:"inline-block px-5 py-2 bg-white text-blue-700 font-semibold rounded-md hover:bg-blue-50 transition-colors duration-150 ease-in-out shadow-sm text-sm",onClick:i[0]||(i[0]=v=>c("view_all_public_maps"))},{default:ge(()=>i[4]||(i[4]=[Z(" View All Public Maps ")])),_:1,__:[4]},8,["href"]),V(te(be),{href:n.route("reports.map.index"),class:"inline-block px-5 py-2 bg-white text-blue-700 font-semibold rounded-md hover:bg-blue-50 transition-colors duration-150 ease-in-out shadow-sm text-sm",onClick:i[1]||(i[1]=v=>c("view_report_maps"))},{default:ge(()=>i[5]||(i[5]=[Z(" View Report Maps ")])),_:1,__:[5]},8,["href"])])])):n.$page.props.auth.user?P("",!0):(p(),f("div",ln,[i[9]||(i[9]=t("h3",{class:"text-xl font-semibold"},"Discover Community & Report Maps!",-1)),i[10]||(i[10]=t("p",{class:"text-sm mt-1 mb-3 text-blue-100"},"Explore maps created by our community or view our curated data reports.",-1)),t("div",rn,[V(te(be),{href:n.route("saved-maps.index"),class:"px-6 py-2 bg-white text-blue-700 font-semibold rounded-md hover:bg-blue-50 transition-colors duration-150 ease-in-out shadow-md",onClick:i[2]||(i[2]=v=>c("guest_view_public_maps"))},{default:ge(()=>i[7]||(i[7]=[Z(" Explore Public Maps ")])),_:1,__:[7]},8,["href"]),V(te(be),{href:n.route("reports.map.index"),class:"px-6 py-2 bg-white text-blue-700 font-semibold rounded-md hover:bg-blue-50 transition-colors duration-150 ease-in-out shadow-md",onClick:i[3]||(i[3]=v=>c("guest_view_report_maps"))},{default:ge(()=>i[8]||(i[8]=[Z(" View Report Maps ")])),_:1,__:[8]},8,["href"])])]))])])):P("",!0)}},un=he(cn,[["__scopeId","data-v-67813787"]]);const dn={class:"before-map"},gn={class:"text-2xl font-bold text-gray-800 text-center my-4"},vn={class:"reportRadius-slider-input"},mn={for:"reportRadius",class:"block text-sm font-medium text-gray-700"},pn={class:"text-sm text-gray-600"},fn={class:"map-controls-container"},hn={class:"case-details"},yn={class:"text-xl font-semibold text-gray-800 text-center my-4"},bn={__name:"RadialMap",props:{initialLat:{type:Number,default:null},initialLng:{type:Number,default:null}},setup(e){const m=e,h=Ae(),g=B(null),c=B({}),a=B({}),n=B([]),i=B([]),v=B([]),x=B({latitude:m.initialLat||42.3601,longitude:m.initialLng||-71.0589,address:m.initialLat&&m.initialLng?`${m.initialLat.toFixed(4)}, ${m.initialLng.toFixed(4)}`:"Boston, MA"}),b=B(.25),L=B(!1),_=B(null),I=B([x.value.latitude,x.value.longitude]),C=B(!1),A=B([]),z=B(""),F=B(""),$=B(null),w=B(!1),o=B(!1),s=j(()=>!!h.props.auth.user),u=()=>{const{latitude:d,longitude:T}=x.value;if(d&&T){const N=`/map/${d.toFixed(6)}/${T.toFixed(6)}`;Xe.replace(N,{preserveState:!0,preserveScroll:!0})}},M=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),k=Qe("translations"),l=B(["en-US"]),D=d=>{const T=d.filter(G=>G.alcivartech_type==="Food Inspection"),N=d.filter(G=>G.alcivartech_type!=="Food Inspection");if(T.length===0)return N;const W=T.reduce((G,Q)=>{const xe=Q.food_inspection_data;if(!xe)return N.push(Q),G;const ve=xe.licenseno;return ve?(G[ve]||(G[ve]=[]),G[ve].push(Q),G):(N.push(Q),G)},{}),K=Object.values(W).map(G=>{if(G.length===0)return null;G.sort((me,Ce)=>{var ne,pe;const ae=((ne=me.food_inspection_data)==null?void 0:ne.alcivartech_date)||me.alcivartech_date,de=((pe=Ce.food_inspection_data)==null?void 0:pe.alcivartech_date)||Ce.alcivartech_date;return new Date(de)-new Date(ae)});const Q=G[0],xe=Q.food_inspection_data;if(!xe)return null;const ve=G.filter(me=>me.food_inspection_data&&me.food_inspection_data.violdttm);let De=null;if(ve.length>0){const me=ve.reduce((ae,de)=>{const ne=de.food_inspection_data,pe=ne.violdesc||"Unknown Violation Description";return ae[pe]||(ae[pe]={violdesc:pe,entries:[]}),ae[pe].entries.push({alcivartech_date:de.alcivartech_date,viol_status:ne.viol_status,comments:ne.comments,result:ne.result,viol_level:ne.viol_level}),ae},{}),Ce=Object.values(me).map(ae=>(ae.entries.sort((de,ne)=>new Date(ne.alcivartech_date)-new Date(de.alcivartech_date)),ae));Ce.sort((ae,de)=>ae.violdesc.localeCompare(de.violdesc)),De=Ce}const Be={...Q,food_inspection_data:{...xe,_is_aggregated_food_violation:!0}};return De&&(Be.food_inspection_data.violation_summary=De),Be.alcivartech_date=Q.alcivartech_date,Be}).filter(Boolean);return[...N,...K]},y=j(()=>l.value[0]),S=j(()=>{const d=l.value[0]||"en-US";return{"en-US":"en","es-MX":"es","zh-CN":"zh-CN","ht-HT":"ht","vi-VN":"vi","pt-BR":"pt"}[d]||"en"}),R=()=>{L.value=!L.value,L.value?C.value=!1:(_.value=null,C.value=!0,je(()=>{C.value=!1}))},O=d=>{L.value&&(_.value={lat:d.lat,lng:d.lng},x.value.latitude=d.lat,x.value.longitude=d.lng,x.value.address=`${d.lat.toFixed(3)}, ${d.lng.toFixed(3)}`,I.value=[d.lat,d.lng],u(),g.value&&g.value.destroyMapAndClear(),U().then(()=>{g.value&&g.value.initializeNewMapAtCenter(I.value)}))},E=d=>{x.value.latitude=d.lat,x.value.longitude=d.lng,d.address?x.value.address=d.address:x.value.address=d.lat+", "+d.lng,I.value=[d.lat,d.lng],u(),g.value&&g.value.destroyMapAndClear(),U().then(()=>{g.value&&g.value.initializeNewMapAtCenter([d.lat,d.lng],!0)})},J=d=>{x.value.latitude=d.latitude,x.value.longitude=d.longitude,d.address?x.value.address=d.address:x.value.address=d.latitude+", "+d.longitude,I.value=[d.latitude,d.longitude],u(),g.value&&g.value.destroyMapAndClear(),U().then(()=>{g.value&&g.value.initializeNewMapAtCenter([d.latitude,d.longitude],!0)})},H=()=>{U()},U=async()=>{try{o.value=!0;const d=["en-US"],T=await le.post("/api/map-data",{centralLocation:x.value,language_codes:d,radius:b.value},{headers:{"X-CSRF-TOKEN":M}});c.value=T.data.mapConfiguration||{},n.value=T.data.dataPoints||[],n.value=D(n.value),_e(),Me(),q(),n.value.length>0&&($.value=n.value[0]),setTimeout(()=>{g.value&&g.value.getMapInstance()&&g.value.getMapInstance().invalidateSize()},100),o.value=!1}catch(d){console.error("Error fetching data:",d),o.value=!1,d.response&&d.response.status===419&&window.location.reload()}finally{o.value=!1,setTimeout(()=>{re()},1e3)}},re=async()=>{if(n.value&&n.value.length>0){const d=n.value.filter(T=>T.alcivartech_type==="311 Case"&&T.case_enquiry_id);if(d.length>0){const T=d.map(N=>N.case_enquiry_id.toString());try{const N=await le.post("/api/311-case/live-multiple",{case_enquiry_ids:T},{headers:{"X-CSRF-TOKEN":M}});if(N.status===429){console.error("Rate limit exceeded, retrying in 5 seconds..."),setTimeout(()=>{re()},5e3);return}const W=N.data.data;if(W&&Array.isArray(W)){const K=new Map;if(W.forEach(G=>{G.service_request_id&&K.set(G.service_request_id.toString(),G)}),n.value=n.value.map(G=>{if(G.alcivartech_type==="311 Case"&&G.case_enquiry_id){const Q=K.get(G.case_enquiry_id.toString());if(Q)return{...G,live_details:Q}}return G}),q(),$.value&&$.value.alcivartech_type==="311 Case"&&$.value.case_enquiry_id){const G=K.get($.value.case_enquiry_id.toString());G&&($.value={...$.value,live_details:G})}}}catch(N){console.error("Error fetching live 311 case details:",N),N.response&&N.response.status===419&&window.location.reload()}}}},_e=()=>{if(n.value.length===0){z.value="",F.value="";return}const d=n.value.map(T=>new Date(T.alcivartech_date));z.value=new Date(Math.min(...d)).toISOString().split("T")[0],F.value=new Date(Math.max(...d)).toISOString().split("T")[0]},Me=()=>{const d={};n.value.forEach(T=>{d[T.alcivartech_type]===void 0&&(d[T.alcivartech_type]=a.value[T.alcivartech_type]!==void 0?a.value[T.alcivartech_type]:!0)}),a.value=d},ce=d=>{a.value={...d.activeTypes},A.value=[...d.selectedDates],q()},q=()=>{if(n.value.length===0){i.value=[],v.value=[];return}let d=n.value;A.value.length>0&&(d=d.filter(T=>{const N=new Date(T.alcivartech_date).toISOString().split("T")[0];return A.value.includes(N)})),i.value=d,v.value=i.value.filter(T=>a.value[T.alcivartech_type])},ue=j(()=>v.value),ye=d=>{$.value=d},Te=d=>{var W,K;$.value=d;const T=(W=g.value)==null?void 0:W.getMapInstance(),N=(K=g.value)==null?void 0:K.getMarkers();T&&N&&N.forEach(G=>{G.options.icon.options.className.includes("id"+d.data_point_id)&&G.openPopup()})},Ve=d=>{var W,K;$.value=d;const T=(W=g.value)==null?void 0:W.getMapInstance(),N=(K=g.value)==null?void 0:K.getMarkers();T&&N&&N.forEach(G=>{if(G.options.icon.options.className.includes("id"+d.data_point_id)){G.openPopup();const Q=G.getPopup().getElement();Q&&Q.scrollIntoView({behavior:"smooth",block:"center"})}})};return oe(b,d=>{setTimeout(()=>{U()},500)},{immediate:!0}),we(async()=>{if(m.initialLat&&m.initialLng){U();return}let d=!1;if(s.value)try{const T=await le.get("/locations");T.data&&T.data.length>0&&(J(T.data[0]),d=!0)}catch(T){console.error("Error fetching user locations on mount:",T),T.response&&T.response.status===419&&window.location.reload()}d||(u(),U())}),(d,T)=>(p(),Ze(Je,null,{default:ge(()=>{var N,W,K;return[V(te(Ye),null,{default:ge(()=>T[2]||(T[2]=[t("title",null,"Home",-1)])),_:1,__:[2]}),V(un),t("div",dn,[t("h1",gn,r((N=te(k).LabelsByLanguageCode[y.value])==null?void 0:N.pageTitle),1),V(ka,{centralLocation:x.value,tempNewCenterForDisplay:_.value,isCenterSelectionActive:L.value,language_codes:l.value,translations:te(k),singleLanguageCode:y.value,onToggleCenterSelectionMode:R,onAddressSearchCoordinatesSelected:E,onTriggerFormSubmit:H,onLoadSavedLocation:J},null,8,["centralLocation","tempNewCenterForDisplay","isCenterSelectionActive","language_codes","translations","singleLanguageCode"])]),t("div",vn,[t("label",mn,r(((W=te(k).LabelsByLanguageCode[y.value])==null?void 0:W.reportRadiusLabel)||"Report Radius (miles)"),1),se(t("input",{id:"reportRadius",type:"range",min:"0.01",max:"0.5",step:"0.01","onUpdate:modelValue":T[0]||(T[0]=G=>b.value=G),class:"mt-1 block w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"},null,512),[[Se,b.value,void 0,{number:!0}]]),t("span",pn,r(b.value.toFixed(2))+" miles",1)]),t("div",fn,[V($a,{ref_key:"mapDisplayRef",ref:g,mapCenterCoordinates:I.value,allMapDataPoints:i.value,activeFilterTypes:a.value,isCenterSelectionModeActive:L.value,tempNewMarkerPlacementCoords:_.value,mapIsLoading:o.value,shouldClearTempMarker:C.value,"map-configuration":c.value,onMapCoordinatesSelectedForNewCenter:O,onMarkerDataPointClicked:ye,onMapInitializedInternal:T[1]||(T[1]=G=>w.value=!0)},null,8,["mapCenterCoordinates","allMapDataPoints","activeFilterTypes","isCenterSelectionModeActive","tempNewMarkerPlacementCoords","mapIsLoading","shouldClearTempMarker","map-configuration"]),V(Oa,{initialFilterTypeState:a.value,initialSelectedDates:A.value,minDateForFilter:z.value,maxDateForFilter:F.value,translations:te(k),singleLanguageCode:y.value,onFiltersUpdated:ce},null,8,["initialFilterTypeState","initialSelectedDates","minDateForFilter","maxDateForFilter","translations","singleLanguageCode"])]),t("div",hn,[t("h2",yn,r(((K=te(k).LabelsByLanguageCode[y.value])==null?void 0:K.caseDetailsTitle)||"Selected Case Details"),1),V(ot,{data:$.value,language_codes:l.value,"map-configuration":c.value},null,8,["data","language_codes","map-configuration"])]),V(pt,{dataPoints:v.value,modelToDataKeyMap:c.value.modelToSubObjectKeyMap||{},onOnImageClick:Te},null,8,["dataPoints","modelToDataKeyMap"]),V(Xa,{dataPoints:ue.value,mapConfiguration:c.value},null,8,["dataPoints","mapConfiguration"]),V(et,{context:ue.value,language_codes:l.value,centralLocation:x.value,radius:b.value,currentMapLanguage:S.value},null,8,["context","language_codes","centralLocation","radius","currentMapLanguage"]),V(at,{totalData:v.value,itemsPerPage:8,onHandleGotoMarker:Ve,language_codes:l.value,"map-configuration":c.value},null,8,["totalData","language_codes","map-configuration"])]}),_:1}))}},Bn=he(bn,[["__scopeId","data-v-2dd7418c"]]);export{Bn as default};
